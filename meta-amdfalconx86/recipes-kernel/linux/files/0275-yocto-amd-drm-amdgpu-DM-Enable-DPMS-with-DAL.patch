From bf405446fc22f165e61768c6ac7d5150fa324deb Mon Sep 17 00:00:00 2001
From: Jordan Lazare <Jordan.Lazare@amd.com>
Date: Thu, 20 Aug 2015 17:18:20 -0500
Subject: [PATCH 392/401] drm/amdgpu: [DM] Enable DPMS with DAL

Also fixes screen rotation corruption issue

Signed-off-by: Jordan Lazare <Jordan.Lazare@amd.com>
Reviewed-by: Harry Wentland <Harry.Wentland@amd.com>
Reviewed-by: Vitaly Prosyak <Vitaly.Prosyak@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_dm_types.c | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_types.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_types.c
index 0542daa..e0a69bd 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_types.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_types.c
@@ -1176,10 +1176,8 @@ static void amdgpu_dm_connector_dpms(struct drm_connector *connector, int mode)
 {
 	struct drm_device *dev = connector->dev;
 	struct amdgpu_device *adev = dev->dev_private;
-	/* TODO: uncomment these definitions to enable DPMS call later
 	struct amdgpu_connector *aconnector = to_amdgpu_connector(connector);
-	struct amdgpu_device *adev = connector->dev->dev_private;
-	uint32_t display_index = aconnector->connector_id; */
+	uint32_t display_index = aconnector->connector_id;
 	enum dal_power_state ps;
 
 	if (mode == connector->dpms)
@@ -1203,7 +1201,7 @@ static void amdgpu_dm_connector_dpms(struct drm_connector *connector, int mode)
 		return;
 	}
 
-	/* dal_set_display_dpms(adev->dm.dal, display_index, ps); */
+	dal_set_display_dpms(adev->dm.dal, display_index, ps);
 
 	connector->dpms = mode;
 
-- 
1.9.1

