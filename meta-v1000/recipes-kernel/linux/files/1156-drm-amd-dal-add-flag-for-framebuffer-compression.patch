From 81c8eaf0e9bee00f7afa8b4459431c362fdd8f5e Mon Sep 17 00:00:00 2001
From: Harry Wentland <harry.wentland@amd.com>
Date: Wed, 24 Aug 2016 14:36:30 -0400
Subject: [PATCH 1156/1722] drm/amd/dal: add flag for framebuffer compression

Change-Id: I2cb94e5d2d4e60d76dd55b23ba6b50593108479a
Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/dc.h                         | 1 +
 drivers/gpu/drm/amd/dal/dc/dc_hw_types.h                | 3 +++
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_hw_sequencer.c | 6 ++++--
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c    | 3 ++-
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.h    | 3 ++-
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c  | 3 ++-
 drivers/gpu/drm/amd/dal/dc/inc/hw/mem_input.h           | 3 ++-
 7 files changed, 16 insertions(+), 6 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/dc.h b/drivers/gpu/drm/amd/dal/dc/dc.h
index d75154d..4d7b359 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc.h
@@ -168,6 +168,7 @@ struct dc_surface {
 	union plane_size plane_size;
 	union dc_tiling_info tiling_info;
 	enum dc_color_space color_space;
+	bool compressed;
 
 	enum surface_pixel_format format;
 	enum dc_rotation_angle rotation;
diff --git a/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h b/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h
index 505ebbf..9b68964 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h
@@ -65,6 +65,7 @@ struct dc_plane_address {
 	union {
 		struct{
 			PHYSICAL_ADDRESS_LOC addr;
+			PHYSICAL_ADDRESS_LOC meta;
 		} grph;
 
 		/*stereo*/
@@ -102,6 +103,8 @@ union plane_size {
 		 * is 32 pixel aligned.
 		 */
 		uint32_t surface_pitch;
+
+		uint32_t meta_pitch;
 	} grph;
 
 	struct {
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_hw_sequencer.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_hw_sequencer.c
index 4c1ec03..44a9ddd 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_hw_sequencer.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_hw_sequencer.c
@@ -1642,7 +1642,8 @@ static void set_plane_config(
 			surface->public.format,
 			&surface->public.tiling_info,
 			&surface->public.plane_size,
-			surface->public.rotation);
+			surface->public.rotation,
+			false);
 
 	if (dc->public.config.gpu_vm_support)
 		mi->funcs->mem_input_program_pte_vm(
@@ -1986,7 +1987,8 @@ static void dce110_program_front_end_for_pipe(
 			surface->public.format,
 			&surface->public.tiling_info,
 			&surface->public.plane_size,
-			surface->public.rotation);
+			surface->public.rotation,
+			false);
 
 	if (dc->public.config.gpu_vm_support)
 		mi->funcs->mem_input_program_pte_vm(
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c
index 9205fe9..e80313a 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c
@@ -521,7 +521,8 @@ bool dce110_mem_input_program_surface_config(
 	enum surface_pixel_format format,
 	union dc_tiling_info *tiling_info,
 	union plane_size *plane_size,
-	enum dc_rotation_angle rotation)
+	enum dc_rotation_angle rotation,
+	bool compressed)
 {
 	struct dce110_mem_input *mem_input110 = TO_DCE110_MEM_INPUT(mem_input);
 
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.h b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.h
index a53c6e9..4eeca44 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.h
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.h
@@ -127,7 +127,8 @@ bool  dce110_mem_input_program_surface_config(
 	enum surface_pixel_format format,
 	union dc_tiling_info *tiling_info,
 	union plane_size *plane_size,
-	enum dc_rotation_angle rotation);
+	enum dc_rotation_angle rotation,
+	bool compressed);
 
 /*
  * dce110_mem_input_program_pte_vm
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c
index 47f415c..856c121 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c
@@ -664,7 +664,8 @@ bool dce110_mem_input_v_program_surface_config(
 	enum surface_pixel_format format,
 	union dc_tiling_info *tiling_info,
 	union plane_size *plane_size,
-	enum dc_rotation_angle rotation)
+	enum dc_rotation_angle rotation,
+	bool compressed)
 {
 	struct dce110_mem_input *mem_input110 = TO_DCE110_MEM_INPUT(mem_input);
 
diff --git a/drivers/gpu/drm/amd/dal/dc/inc/hw/mem_input.h b/drivers/gpu/drm/amd/dal/dc/inc/hw/mem_input.h
index bdf6dcb..fd68dc0 100644
--- a/drivers/gpu/drm/amd/dal/dc/inc/hw/mem_input.h
+++ b/drivers/gpu/drm/amd/dal/dc/inc/hw/mem_input.h
@@ -79,7 +79,8 @@ struct mem_input_funcs {
 		enum surface_pixel_format format,
 		union dc_tiling_info *tiling_info,
 		union plane_size *plane_size,
-		enum dc_rotation_angle rotation);
+		enum dc_rotation_angle rotation,
+		bool compressed);
 
 	bool (*mem_input_is_flip_pending)(struct mem_input *mem_input);
 };
-- 
2.7.4

