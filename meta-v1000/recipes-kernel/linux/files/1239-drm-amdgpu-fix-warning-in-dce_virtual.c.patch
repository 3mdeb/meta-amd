From dc5bee667c11e4c99b289529f14fa12e96049d2a Mon Sep 17 00:00:00 2001
From: Alex Deucher <alexander.deucher@amd.com>
Date: Fri, 14 Oct 2016 13:58:58 -0400
Subject: [PATCH 1239/1722] drm/amdgpu: fix warning in dce_virtual.c

copy paste typo when I re-arranged the code.

Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/dce_virtual.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/dce_virtual.c b/drivers/gpu/drm/amd/amdgpu/dce_virtual.c
index a4fbc72..acbc898 100644
--- a/drivers/gpu/drm/amd/amdgpu/dce_virtual.c
+++ b/drivers/gpu/drm/amd/amdgpu/dce_virtual.c
@@ -661,18 +661,18 @@ static int dce_virtual_connector_encoder_init(struct amdgpu_device *adev,
 
 	/* add a new encoder */
 	encoder = kzalloc(sizeof(struct drm_encoder), GFP_KERNEL);
-	if (!encoder) {
-		kfree(connector);
+	if (!encoder)
 		return -ENOMEM;
-	}
 	encoder->possible_crtcs = 1 << index;
 	drm_encoder_init(adev->ddev, encoder, &dce_virtual_encoder_funcs,
 			 DRM_MODE_ENCODER_VIRTUAL, NULL);
 	drm_encoder_helper_add(encoder, &dce_virtual_encoder_helper_funcs);
 
 	connector = kzalloc(sizeof(struct drm_connector), GFP_KERNEL);
-	if (!connector)
+	if (!connector) {
+		kfree(encoder);
 		return -ENOMEM;
+	}
 
 	/* add a new connector */
 	drm_connector_init(adev->ddev, connector, &dce_virtual_connector_funcs,
-- 
2.7.4

