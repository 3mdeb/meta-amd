From fdadda91e3fddc903e171a24beef0efa3bfde18b Mon Sep 17 00:00:00 2001
From: Vitaly Prosyak <vitaly.prosyak@amd.com>
Date: Thu, 22 Sep 2016 16:25:02 -0400
Subject: [PATCH 1110/1722] drm/amd/dal: Fix nullptr on disable output

Remove stream free logic from freesync module.

Change-Id: Ib0a851a2bce9c14a66eb40da939aa8ea216ad708
Signed-off-by: Vitaly Prosyak <vitaly.prosyak@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/modules/freesync/freesync.c | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c b/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c
index 7b89dfa..77e9997 100644
--- a/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c
+++ b/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c
@@ -307,13 +307,8 @@ bool mod_freesync_add_stream(struct mod_freesync *mod_freesync,
 		core_freesync->num_streams < MOD_FREESYNC_MAX_CONCURRENT_SINKS) {
 
 		unsigned int index = map_index_from_sink(core_freesync, stream->sink);
-		if (core_freesync->map[index].stream) {
-			dc_stream_release(core_freesync->map[index].stream);
-			core_freesync->num_streams--;
-			/* don't need any other part of mod_freesync_remove_stream */
-		}
+		ASSERT(core_freesync->map[index].stream == NULL);
 		dc_stream_retain(stream);
-
 		if (core_freesync->map[index].caps.supported)
 			core_stream->public.ignore_msa_timing_param = 1;
 
-- 
2.7.4

