From 5aab30911c2def86f8f4dadffe0cdd5d3bded2e3 Mon Sep 17 00:00:00 2001
From: Mykola Lysenko <Mykola.Lysenko@amd.com>
Date: Mon, 11 Jul 2016 13:10:56 +0800
Subject: [PATCH 0635/1722] drm/amd/dal: remove send_null_packet

Cleanup this function as the functionality is not
required.

Signed-off-by: Mykola Lysenko <Mykola.Lysenko@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc.c               | 21 ------------
 drivers/gpu/drm/amd/dal/dc/dc.h                    |  1 -
 .../drm/amd/dal/dc/dce110/dce110_stream_encoder.c  | 37 +---------------------
 .../drm/amd/dal/dc/dce80/dce80_stream_encoder.c    | 11 +------
 drivers/gpu/drm/amd/dal/dc/inc/hw/stream_encoder.h |  3 --
 5 files changed, 2 insertions(+), 71 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc.c b/drivers/gpu/drm/amd/dal/dc/core/dc.c
index 2e6f32d..68f4d41 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc.c
@@ -253,32 +253,11 @@ static bool set_gamut_remap(struct dc *dc,
 	return ret;
 }
 
-static void stream_send_null_packet(const struct dc_stream *dc_stream,
-		bool enable)
-{
-	struct core_stream *stream = DC_STREAM_TO_CORE(dc_stream);
-	struct core_dc *core_dc = DC_TO_CORE(stream->ctx->dc);
-
-	int i;
-
-	struct resource_context *res_ctx = &core_dc->current_context->res_ctx;
-
-	for (i = 0; i < res_ctx->pool->pipe_count; i++) {
-		if (res_ctx->pipe_ctx[i].stream != stream)
-			continue;
-
-		res_ctx->pipe_ctx[i].stream_enc->funcs->
-		send_null_packet(res_ctx->pipe_ctx[i].stream_enc, enable);
-	}
-}
-
 static void allocate_dc_stream_funcs(struct core_dc *core_dc)
 {
 	if (core_dc->hwss.set_drr != NULL) {
 		core_dc->public.stream_funcs.adjust_vmin_vmax =
 				stream_adjust_vmin_vmax;
-		core_dc->public.stream_funcs.send_null_packet =
-				stream_send_null_packet;
 	}
 
 	core_dc->public.stream_funcs.set_gamut_remap =
diff --git a/drivers/gpu/drm/amd/dal/dc/dc.h b/drivers/gpu/drm/amd/dal/dc/dc.h
index dd43b6b..f66c639 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc.h
@@ -55,7 +55,6 @@ struct dc_surface;
 struct dc_stream_funcs {
 	bool (*adjust_vmin_vmax)(struct dc *dc,
 			const struct dc_stream **stream, int num_streams, int vmin, int vmax);
-	void (*send_null_packet)(const struct dc_stream *dc_stream, bool enable);
 	bool (*set_gamut_remap)(struct dc *dc,
 			const struct dc_stream **stream, int num_streams);
 };
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.c
index 389ce48..63b2df1 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.c
@@ -1069,40 +1069,6 @@ static void dce110_stream_encoder_dp_unblank(
 	dm_write_reg(ctx, addr, value);
 }
 
-static void send_null_packet(
-	struct stream_encoder *enc,
-	bool enable)
-{
-	struct dce110_stream_encoder *enc110 = DCE110STRENC_FROM_STRENC(enc);
-	struct dc_context *ctx = enc110->base.ctx;
-	uint32_t addr = LINK_REG(HDMI_CONTROL);
-	uint32_t value = dm_read_reg(ctx, addr);
-	if (enable) {
-		set_reg_field_value(
-				value,
-				0,
-				HDMI_CONTROL,
-				HDMI_NO_EXTRA_NULL_PACKET_FILLED);
-		set_reg_field_value(
-				value,
-				0,
-				HDMI_CONTROL,
-				HDMI_PACKET_GEN_VERSION);
-	} else {
-		set_reg_field_value(
-				value,
-				0,
-				HDMI_CONTROL,
-				HDMI_NO_EXTRA_NULL_PACKET_FILLED);
-		set_reg_field_value(
-				value,
-				1,
-				HDMI_CONTROL,
-				HDMI_PACKET_GEN_VERSION);
-	}
-	dm_write_reg(ctx, addr, value);
-}
-
 static const struct stream_encoder_funcs dce110_str_enc_funcs = {
 	.dp_set_stream_attribute =
 		dce110_stream_encoder_dp_set_stream_attribute,
@@ -1123,8 +1089,7 @@ static const struct stream_encoder_funcs dce110_str_enc_funcs = {
 	.dp_blank =
 		dce110_stream_encoder_dp_blank,
 	.dp_unblank =
-		dce110_stream_encoder_dp_unblank,
-	.send_null_packet = send_null_packet
+		dce110_stream_encoder_dp_unblank
 };
 
 bool dce110_stream_encoder_construct(
diff --git a/drivers/gpu/drm/amd/dal/dc/dce80/dce80_stream_encoder.c b/drivers/gpu/drm/amd/dal/dc/dce80/dce80_stream_encoder.c
index d0373b3..e811658 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce80/dce80_stream_encoder.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce80/dce80_stream_encoder.c
@@ -1051,13 +1051,6 @@ static void dce80_stream_encoder_dp_unblank(
 	dm_write_reg(ctx, addr, value);
 }
 
-static void dce80_send_null_packet(
-		struct stream_encoder *enc,
-		bool enable)
-{
-
-}
-
 static const struct stream_encoder_funcs dce80_str_enc_funcs = {
 	.dp_set_stream_attribute =
 		dce80_stream_encoder_dp_set_stream_attribute,
@@ -1078,9 +1071,7 @@ static const struct stream_encoder_funcs dce80_str_enc_funcs = {
 	.dp_blank =
 		dce80_stream_encoder_dp_blank,
 	.dp_unblank =
-		dce80_stream_encoder_dp_unblank,
-	.send_null_packet =
-		dce80_send_null_packet
+		dce80_stream_encoder_dp_unblank
 };
 
 bool dce80_stream_encoder_construct(
diff --git a/drivers/gpu/drm/amd/dal/dc/inc/hw/stream_encoder.h b/drivers/gpu/drm/amd/dal/dc/inc/hw/stream_encoder.h
index 480926e..a31dcc9 100644
--- a/drivers/gpu/drm/amd/dal/dc/inc/hw/stream_encoder.h
+++ b/drivers/gpu/drm/amd/dal/dc/inc/hw/stream_encoder.h
@@ -82,9 +82,6 @@ struct stream_encoder_funcs {
 	void (*dp_unblank)(
 		struct stream_encoder *enc,
 		const struct encoder_unblank_param *param);
-	void (*send_null_packet)(
-		struct stream_encoder *enc,
-		bool enable);
 };
 
 #endif /* STREAM_ENCODER_H_ */
-- 
2.7.4

