From 86e6d6b94a5286f08b0909a01cd7fe3c80efa1d0 Mon Sep 17 00:00:00 2001
From: Junwei Zhang <Jerry.Zhang@amd.com>
Date: Wed, 21 Sep 2016 10:17:22 +0800
Subject: [PATCH 1045/1722] drm/amd/amdgpu: add info about vram and gtt total
 size
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Change-Id: Iaa21abee353f36ab97221a465d619fbb898fcc02
Signed-off-by: Junwei Zhang <Jerry.Zhang@amd.com>
Reviewed-by: Christian KÃ¶nig <christian.koenig@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_kms.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_kms.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_kms.c
index 4746f0e..b6473ba 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_kms.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_kms.c
@@ -411,6 +411,16 @@ static int amdgpu_info_ioctl(struct drm_device *dev, void *data, struct drm_file
 		return copy_to_user(out, &vram_gtt,
 				    min((size_t)size, sizeof(vram_gtt))) ? -EFAULT : 0;
 	}
+	case AMDGPU_INFO_VRAM_GTT_TOTAL: {
+		struct drm_amdgpu_info_vram_gtt_total vram_gtt_total;
+
+		vram_gtt_total.vram_total_size = adev->mc.real_vram_size;
+		vram_gtt_total.vram_cpu_accessible_total_size = adev->mc.visible_vram_size;
+		vram_gtt_total.gtt_total_size = adev->mc.gtt_size;
+		return copy_to_user(out, &vram_gtt_total,
+				    min((size_t)size, sizeof(vram_gtt_total)))
+				    ? -EFAULT : 0;
+	}
 	case AMDGPU_INFO_READ_MMR_REG: {
 		unsigned n, alloc_size;
 		uint32_t *regs;
-- 
2.7.4

