From 713bcd22fd7ec4bc8778ed80157059e475ddc763 Mon Sep 17 00:00:00 2001
From: Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>
Date: Fri, 12 Aug 2016 14:57:56 -0400
Subject: [PATCH 0750/1722] drm/amd/dal: limit mpo to full rgb displays

Signed-off-by: Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
index 63db218..4eb383e 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
@@ -614,11 +614,10 @@ static bool is_surface_pixel_format_supported(struct pipe_ctx *pipe_ctx)
 {
 	if (pipe_ctx->pipe_idx != DCE110_UNDERLAY_IDX)
 		return true;
-	if (pipe_ctx->surface && pipe_ctx->surface->public.format <
-					SURFACE_PIXEL_FORMAT_VIDEO_BEGIN)
-		return false;
 	if (!pipe_ctx->surface)
 		return false;
+	if (pipe_ctx->surface->public.format < SURFACE_PIXEL_FORMAT_VIDEO_BEGIN)
+		return false;
 	return true;
 }
 
@@ -918,6 +917,9 @@ static bool dce110_validate_surface_sets(
 			if (set[i].surfaces[1]->src_rect.width > 1920
 					|| set[i].surfaces[1]->src_rect.height > 1080)
 				return false;
+
+			if (set[i].target->streams[0]->timing.pixel_encoding != PIXEL_ENCODING_RGB)
+				return false;
 		}
 	}
 
-- 
2.7.4

