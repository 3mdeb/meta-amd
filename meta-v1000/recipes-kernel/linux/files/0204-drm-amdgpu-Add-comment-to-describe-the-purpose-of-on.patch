From 4ed20e21692a9e556a737c6175e1483b9e33496f Mon Sep 17 00:00:00 2001
From: Alex Xie <AlexBin.Xie@amd.com>
Date: Mon, 6 Jun 2016 18:14:57 -0400
Subject: [PATCH 0204/1722] drm/amdgpu: Add comment to describe the purpose of
 one difficult if statement
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Use == instead of != in the if statement to make code easier understood

Signed-off-by: Alex Xie <AlexBin.Xie@amd.com>
Reviewed-by: Christian KÃ¶nig <christian.koenig@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
index b9fce4c..1836d2d 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
@@ -776,19 +776,20 @@ static void amdgpu_vm_update_ptes(struct amdgpu_device *adev,
                 next_pe_start = amdgpu_bo_gpu_offset(pt);
                 next_pe_start += (addr & mask) * 8;	
  
-                if (cur_pe_end != next_pe_start) {
-
+                if (cur_pe_end == next_pe_start) {
+                        /* The next ptb is consecutive to current ptb.
+                         * Don't call amdgpu_vm_frag_ptes now.
+                         * Will update two ptbs together in future.
+                        */
+                        cur_pe_end += 8 * nptes;
+                } else {
                         amdgpu_vm_frag_ptes(adev, vm_update_params,
                                             cur_pe_start, cur_pe_end,
                                             cur_dst, flags);
                         cur_pe_start = next_pe_start;
                         cur_pe_end = next_pe_start + 8 * nptes;
                         cur_dst = dst;
-
-		} else {
-                        cur_pe_end += 8 * nptes;
 		}
-
 		addr += nptes;
 		dst += nptes * AMDGPU_GPU_PAGE_SIZE;
 	}
-- 
2.7.4

