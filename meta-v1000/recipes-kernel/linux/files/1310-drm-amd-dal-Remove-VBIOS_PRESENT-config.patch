From b8bbf7ec93b49c84e1392374e53581c6b9c7518b Mon Sep 17 00:00:00 2001
From: Harry Wentland <harry.wentland@amd.com>
Date: Fri, 7 Oct 2016 11:21:54 -0400
Subject: [PATCH 1310/1722] drm/amd/dal: Remove VBIOS_PRESENT config

Change-Id: I11ddd9b9a4009d4bcf781c992bf32d7d97ec7032
Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/bios/bios_parser.c         | 19 -------------------
 .../drm/amd/dal/dc/bios/bios_parser_types_internal.h  |  2 --
 .../dal/dc/bios/dce110/bios_parser_helper_dce110.c    |  2 --
 3 files changed, 23 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser.c b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser.c
index 63b4d4f..9d186f5 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser.c
+++ b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser.c
@@ -35,10 +35,8 @@
 #include "include/logger_interface.h"
 
 #include "command_table.h"
-#if defined(CONFIG_DRM_AMD_DAL_VBIOS_PRESENT)
 #include "bios_parser_helper.h"
 #include "dce110/bios_dce110.h"
-#endif
 #include "command_table_helper.h"
 #include "bios_parser.h"
 #include "bios_parser_types_internal.h"
@@ -3664,16 +3662,8 @@ static bool bios_parser_is_accelerated_mode(
 {
 	struct bios_parser *bp = BP_FROM_DCB(dcb);
 
-#ifdef CONFIG_DRM_AMD_DAL_VBIOS_PRESENT
 	return bp->bios_helper->is_accelerated_mode(
 			bp->base.ctx);
-#else
-	dal_logger_write(bp->base.ctx->logger,
-			LOG_MAJOR_BIOS,
-			LOG_MINOR_BIOS_CMD_TABLE,
-			"%s: VBIOS is not supported", __func__);
-	return false;
-#endif
 }
 
 /**
@@ -3691,15 +3681,8 @@ static void bios_parser_set_scratch_critical_state(
 {
 	struct bios_parser *bp = BP_FROM_DCB(dcb);
 
-#ifdef CONFIG_DRM_AMD_DAL_VBIOS_PRESENT
 	dce110_set_scratch_critical_state(
 			bp->base.ctx, state);
-#else
-	dal_logger_write(bp->base.ctx->logger,
-			LOG_MAJOR_BIOS,
-			LOG_MINOR_BIOS_CMD_TABLE,
-			"%s: VBIOS is not supported", __func__);
-#endif
 }
 
 /*
@@ -4253,9 +4236,7 @@ static bool bios_parser_construct(
 	else
 		return false;
 
-#if defined(CONFIG_DRM_AMD_DAL_VBIOS_PRESENT)
 	dal_bios_parser_init_bios_helper(bp, dce_version);
-#endif
 	dal_bios_parser_init_cmd_tbl(bp);
 	dal_bios_parser_init_cmd_tbl_helper(&bp->cmd_helper, dce_version);
 
diff --git a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_types_internal.h b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_types_internal.h
index b286a18..5918923 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_types_internal.h
+++ b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_types_internal.h
@@ -57,9 +57,7 @@ struct bios_parser {
 	uint32_t object_info_tbl_offset;
 	ATOM_MASTER_DATA_TABLE *master_data_tbl;
 
-#if defined(CONFIG_DRM_AMD_DAL_VBIOS_PRESENT)
 	const struct bios_parser_helper *bios_helper;
-#endif /* CONFIG_DRM_AMD_DAL_VBIOS_PRESENT */
 
 	const struct command_table_helper *cmd_helper;
 	struct cmd_tbl cmd_tbl;
diff --git a/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c b/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c
index 7147fe7..2806e1e 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c
+++ b/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c
@@ -48,7 +48,6 @@
  */
 void dce110_set_scratch_acc_mode_change(struct dc_context *ctx)
 {
-#ifdef CONFIG_DRM_AMD_DAL_VBIOS_PRESENT
 	uint32_t addr = mmBIOS_SCRATCH_6;
 	uint32_t value = 0;
 
@@ -57,7 +56,6 @@ void dce110_set_scratch_acc_mode_change(struct dc_context *ctx)
 	value |= ATOM_S6_ACC_MODE;
 
 	dm_write_reg(ctx, addr, value);
-#endif
 }
 
 /*
-- 
2.7.4

