From 924e600669fbccd71e2bd3c737a5fef2fce09a4b Mon Sep 17 00:00:00 2001
From: Dave Airlie <airlied@redhat.com>
Date: Tue, 12 Apr 2016 09:32:32 +1000
Subject: [PATCH 0539/1722] drm/amd/dal: drop bios parser lid interfaces.

Neither of these are used currently.

Signed-off-by: Dave Airlie <airlied@redhat.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 .../gpu/drm/amd/dal/dc/bios/bios_parser_helper.c   | 31 ----------------
 .../gpu/drm/amd/dal/dc/bios/bios_parser_helper.h   |  4 ---
 .../dal/dc/bios/dce110/bios_parser_helper_dce110.c | 17 ---------
 .../dal/dc/bios/dce112/bios_parser_helper_dce112.c | 17 ---------
 .../dal/dc/bios/dce80/bios_parser_helper_dce80.c   | 41 ----------------------
 .../drm/amd/dal/include/bios_parser_interface.h    |  6 ----
 6 files changed, 116 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.c b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.c
index 2037f15..63f753a 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.c
+++ b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.c
@@ -66,34 +66,3 @@ bool dal_bios_parser_init_bios_helper(
 		return false;
 	}
 }
-
-bool dal_bios_parser_is_lid_open(
-	struct bios_parser *bp)
-{
-	const struct graphics_object_id encoder = dal_graphics_object_id_init(
-		ENCODER_ID_INTERNAL_UNIPHY,
-		ENUM_ID_UNKNOWN,
-		OBJECT_TYPE_UNKNOWN);
-	const struct graphics_object_id connector = dal_graphics_object_id_init(
-		CONNECTOR_ID_LVDS,
-		ENUM_ID_UNKNOWN,
-		OBJECT_TYPE_UNKNOWN);
-
-	enum signal_type signal;
-
-	/* check if VBIOS reported LCD as connected */
-	signal = bp->bios_helper->detect_sink(bp->ctx,
-		encoder, connector, SIGNAL_TYPE_LVDS);
-
-	if (signal == SIGNAL_TYPE_NONE)
-		return false;
-
-	return bp->bios_helper->is_lid_open(bp->ctx);
-}
-
-bool dal_bios_parser_is_lid_status_changed(
-	struct bios_parser *bp)
-{
-	return bp->bios_helper->is_lid_status_changed(
-			bp->ctx);
-}
diff --git a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.h b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.h
index 556c57c..481a83e 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.h
+++ b/drivers/gpu/drm/amd/dal/dc/bios/bios_parser_helper.h
@@ -51,10 +51,6 @@ struct bios_parser_helper {
 		struct graphics_object_id encoder,
 		struct graphics_object_id connector,
 		enum signal_type signal);
-	bool (*is_lid_open)(
-		struct dc_context *ctx);
-	bool (*is_lid_status_changed)(
-		struct dc_context *ctx);
 	void (*set_scratch_acc_mode_change)(
 		struct dc_context *ctx);
 	bool (*is_accelerated_mode)(
diff --git a/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c b/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c
index 88c3470..3ed297b 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c
+++ b/drivers/gpu/drm/amd/dal/dc/bios/dce110/bios_parser_helper_dce110.c
@@ -276,28 +276,11 @@ void dce110_set_scratch_critical_state(struct dc_context *ctx,
 	dm_write_reg(ctx, addr, value);
 }
 
-static bool is_lid_open(struct dc_context *ctx)
-{
-	uint32_t bios_scratch6;
-
-	bios_scratch6 =
-		dm_read_reg(
-			ctx,
-			mmBIOS_SCRATCH_0 + ATOM_ACC_CHANGE_INFO_DEF);
-
-	/* lid is open if the bit is not set */
-	if (!(bios_scratch6 & ATOM_S6_LID_STATE))
-		return true;
-
-	return false;
-}
-
 /* function table */
 static const struct bios_parser_helper bios_parser_helper_funcs = {
 	.detect_sink = detect_sink,
 	.get_scratch_lcd_scale = get_scratch_lcd_scale,
 	.is_accelerated_mode = is_accelerated_mode,
-	.is_lid_open = is_lid_open,
 	.prepare_scratch_active_and_requested =
 			prepare_scratch_active_and_requested,
 };
diff --git a/drivers/gpu/drm/amd/dal/dc/bios/dce112/bios_parser_helper_dce112.c b/drivers/gpu/drm/amd/dal/dc/bios/dce112/bios_parser_helper_dce112.c
index 46cc3aa..45339e7 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/dce112/bios_parser_helper_dce112.c
+++ b/drivers/gpu/drm/amd/dal/dc/bios/dce112/bios_parser_helper_dce112.c
@@ -260,28 +260,11 @@ static enum signal_type detect_sink(
 	return SIGNAL_TYPE_NONE;
 }
 
-static bool is_lid_open(struct dc_context *ctx)
-{
-	uint32_t bios_scratch6;
-
-	bios_scratch6 =
-		dm_read_reg(
-			ctx,
-			mmBIOS_SCRATCH_0 + ATOM_ACC_CHANGE_INFO_DEF);
-
-	/* lid is open if the bit is not set */
-	if (!(bios_scratch6 & ATOM_S6_LID_STATE))
-		return true;
-
-	return false;
-}
-
 /* function table */
 static const struct bios_parser_helper bios_parser_helper_funcs = {
 	.detect_sink = detect_sink,
 	.get_scratch_lcd_scale = get_scratch_lcd_scale,
 	.is_accelerated_mode = is_accelerated_mode,
-	.is_lid_open = is_lid_open,
 	.prepare_scratch_active_and_requested =
 			prepare_scratch_active_and_requested,
 	.set_scratch_acc_mode_change = set_scratch_acc_mode_change
diff --git a/drivers/gpu/drm/amd/dal/dc/bios/dce80/bios_parser_helper_dce80.c b/drivers/gpu/drm/amd/dal/dc/bios/dce80/bios_parser_helper_dce80.c
index ea0cfcb..70735be 100644
--- a/drivers/gpu/drm/amd/dal/dc/bios/dce80/bios_parser_helper_dce80.c
+++ b/drivers/gpu/drm/amd/dal/dc/bios/dce80/bios_parser_helper_dce80.c
@@ -110,45 +110,6 @@ static enum signal_type detect_sink(
 	return sink;
 }
 
-static bool is_lid_open(struct dc_context *ctx)
-{
-	bool result = false;
-
-	/* VBIOS does not provide bitfield definitions */
-	uint32_t reg;
-
-	reg = dm_read_reg(ctx,
-		mmBIOS_SCRATCH_0 + ATOM_ACC_CHANGE_INFO_DEF);
-
-	/* lid is open if the bit is not set */
-	result = !(reg & ATOM_S6_LID_STATE);
-
-	return result;
-}
-
-static bool is_lid_status_changed(
-	struct dc_context *ctx)
-{
-	bool result = false;
-
-	/* VBIOS does not provide bitfield definitions */
-	uint32_t reg;
-
-	reg = dm_read_reg(ctx,
-		mmBIOS_SCRATCH_6);
-
-	/* lid is open if the bit is not set */
-	if (reg & ATOM_S6_LID_CHANGE) {
-		reg &= ~ATOM_S6_LID_CHANGE;
-		dm_write_reg(ctx,
-				mmBIOS_SCRATCH_6, reg);
-
-		result = true;
-	}
-
-	return result;
-}
-
 /**
  * is_accelerated_mode
  *
@@ -271,8 +232,6 @@ static const struct bios_parser_helper bios_parser_helper_funcs = {
 	.detect_sink = detect_sink,
 	.get_scratch_lcd_scale = get_scratch_lcd_scale,
 	.is_accelerated_mode = is_accelerated_mode,
-	.is_lid_open = is_lid_open,
-	.is_lid_status_changed = is_lid_status_changed,
 	.prepare_scratch_active_and_requested =
 		prepare_scratch_active_and_requested,
 };
diff --git a/drivers/gpu/drm/amd/dal/include/bios_parser_interface.h b/drivers/gpu/drm/amd/dal/include/bios_parser_interface.h
index e3b5ff5..5f1c567 100644
--- a/drivers/gpu/drm/amd/dal/include/bios_parser_interface.h
+++ b/drivers/gpu/drm/amd/dal/include/bios_parser_interface.h
@@ -43,10 +43,4 @@ struct dc_bios *dal_bios_parser_create(
 void dal_bios_parser_destroy(
 	struct dc_bios **dcb);
 
-/*****************************************************************************/
-/* Interfaces of BIOS Parser Helper */
-bool dal_bios_parser_is_lid_open(
-	struct bios_parser *bp);
-bool dal_bios_parser_is_lid_status_changed(
-	struct bios_parser *bp);
 #endif /* __DAL_BIOS_PARSER_INTERFACE_H__ */
-- 
2.7.4

