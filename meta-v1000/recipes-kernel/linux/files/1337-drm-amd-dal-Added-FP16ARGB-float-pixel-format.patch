From 1fb35f542e4b2dbf56d832cdfca67986203ab158 Mon Sep 17 00:00:00 2001
From: Vitaly Prosyak <vitaly.prosyak@amd.com>
Date: Fri, 14 Oct 2016 09:29:05 -0500
Subject: [PATCH 1337/1722] drm/amd/dal: Added FP16ARGB float pixel format

Change-Id: I69e2b9b4a79579f2fc3dcc4023d3feab7c0a6222
Signed-off-by: Vitaly Prosyak <vitaly.prosyak@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc_resource.c          | 7 ++-----
 drivers/gpu/drm/amd/dal/dc/dc_hw_types.h               | 2 ++
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c   | 2 +-
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c | 1 +
 4 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c b/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
index 2c4646c..0cbd8b9 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
@@ -338,20 +338,17 @@ static enum pixel_format convert_pixel_format_to_dalsurface(
 	case SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010_XR_BIAS:
 		dal_pixel_format = PIXEL_FORMAT_ARGB2101010_XRBIAS;
 		break;
-	case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:
-		dal_pixel_format = PIXEL_FORMAT_FP16;
-		break;
 	case SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F:
+	case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616F:
 		dal_pixel_format = PIXEL_FORMAT_FP16;
 		break;
-
 	case SURFACE_PIXEL_FORMAT_VIDEO_420_YCbCr:
 		dal_pixel_format = PIXEL_FORMAT_420BPP12;
 		break;
 	case SURFACE_PIXEL_FORMAT_VIDEO_420_YCrCb:
 		dal_pixel_format = PIXEL_FORMAT_420BPP12;
 		break;
-
+	case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:
 	default:
 		dal_pixel_format = PIXEL_FORMAT_UNKNOWN;
 		break;
diff --git a/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h b/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h
index 9b68964..0a6510d 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc_hw_types.h
@@ -148,6 +148,8 @@ enum surface_pixel_format {
 	SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010_XR_BIAS,
 	/*64 bpp */
 	SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616,
+	/*float*/
+	SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616F,
 	/*swaped & float*/
 	SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F,
 	/*grow graphics here if necessary */
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c
index 4761c32..6da8310 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input.c
@@ -296,6 +296,7 @@ static void program_pixel_format(
 			break;
 		case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:
 		case SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F:
+		case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616F:
 			set_reg_field_value(
 				value, 3, GRPH_CONTROL, GRPH_DEPTH);
 			set_reg_field_value(
@@ -309,7 +310,6 @@ static void program_pixel_format(
 			DCP_REG(mmGRPH_CONTROL),
 			value);
 
-		/*TODO [hwentlan] MOVE THIS TO CONTROLLER GAMMA!!!!!*/
 		value = dm_read_reg(
 			mem_input110->base.ctx,
 			DCP_REG(mmPRESCALE_GRPH_CONTROL));
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c
index 856c121..2af14f7 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_mem_input_v.c
@@ -418,6 +418,7 @@ static void program_pixel_format(
 			break;
 		case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:
 		case SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F:
+		case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616F:
 			grph_depth = 3;
 			grph_format = 0;
 			break;
-- 
2.7.4

