From 27240f62150d974a799d2b1873a7e0cefe4d2bc7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Date: Thu, 11 Aug 2016 16:44:15 +0200
Subject: [PATCH 0709/1722] drm/amdgpu: remove pages_addr handling from the VM
 code
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Not needed any more.

Signed-off-by: Christian KÃ¶nig <christian.koenig@amd.com>
Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
Reviewed-by: Edward O'Callaghan <funfunctor@folklore1984.net>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c | 10 +---------
 1 file changed, 1 insertion(+), 9 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
index 8f33eff..7eab178 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_vm.c
@@ -62,8 +62,6 @@ struct amdgpu_pte_update_params {
 	struct amdgpu_device *adev;
 	/* address where to copy page table entries from */
 	uint64_t src;
-	/* DMA addresses to use for mapping */
-	dma_addr_t *pages_addr;
 	/* indirect buffer to fill with commands */
 	struct amdgpu_ib *ib;
 };
@@ -493,11 +491,6 @@ static void amdgpu_vm_update_pages(struct amdgpu_pte_update_params *params,
 		amdgpu_vm_copy_pte(params->adev, params->ib,
 			pe, (params->src + (addr >> 12) * 8), count);
 
-	} else if (params->pages_addr) {
-		amdgpu_vm_write_pte(params->adev, params->ib,
-			params->pages_addr,
-			pe, addr, count, incr, flags);
-
 	} else if (count < 3) {
 		amdgpu_vm_write_pte(params->adev, params->ib, NULL, pe, addr,
 				    count, incr, flags);
@@ -819,7 +812,7 @@ static void amdgpu_vm_frag_ptes(struct amdgpu_pte_update_params        *params,
         uint32_t frag;
  
         /* system pages are non continuously */
-        if (params->src || params->pages_addr || !(flags & AMDGPU_PTE_VALID) ||
+        if (params->src || !(flags & AMDGPU_PTE_VALID) ||
             (frag_start >= frag_end)) {
  
                 amdgpu_vm_update_ptes(params, vm, start, end, dst, flags);
@@ -887,7 +880,6 @@ static int amdgpu_vm_bo_update_mapping(struct amdgpu_device *adev,
         memset(&params, 0, sizeof(params));
         params.adev = adev;
         params.src = src;
-        params.pages_addr = pages_addr;
 
 	/* sync to everything on unmapping */
 	if (!(flags & AMDGPU_PTE_VALID))
-- 
2.7.4

