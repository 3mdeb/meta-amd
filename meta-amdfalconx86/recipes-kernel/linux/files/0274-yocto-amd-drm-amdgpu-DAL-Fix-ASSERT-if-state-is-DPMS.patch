From 3aa38ed7df774118790a59bb89b2f80d38d215fd Mon Sep 17 00:00:00 2001
From: Jordan Lazare <Jordan.Lazare@amd.com>
Date: Wed, 26 Aug 2015 14:40:58 -0500
Subject: [PATCH 391/401] drm/amdgpu: [DAL] Fix ASSERT if state is DPMS

Signed-off-by: Jordan Lazare <Jordan.Lazare@amd.com>
Reviewed-by: Harry Wentland <Harry.Wentland@amd.com>
Reviewed-by: Vitaly Prosyak <Vitaly.Prosyak@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 drivers/gpu/drm/amd/dal/link_service/dpsst_link_service.c | 5 +++--
 drivers/gpu/drm/amd/dal/link_service/link_service.c       | 3 ++-
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/link_service/dpsst_link_service.c b/drivers/gpu/drm/amd/dal/link_service/dpsst_link_service.c
index 4220184..4796d19 100644
--- a/drivers/gpu/drm/amd/dal/link_service/dpsst_link_service.c
+++ b/drivers/gpu/drm/amd/dal/link_service/dpsst_link_service.c
@@ -706,8 +706,9 @@ static bool enable_stream(struct link_service *ls, uint32_t display_index,
 
 	dpsst = container_of(ls, struct dpsst_link_service, link_service);
 
-	if (!(ls->strm_state == STREAM_STATE_DISABLED) ||
-		(ls->strm_state == STREAM_STATE_OPTIMIZED_READY))
+	if ((ls->strm_state != STREAM_STATE_DISABLED) ||
+		(ls->strm_state != STREAM_STATE_OPTIMIZED_READY) ||
+		(ls->strm_state != STREAM_STATE_POWER_SAVE))
 		dal_logger_write(ls->dal_context->logger,
 			LOG_MAJOR_WARNING,
 			LOG_MINOR_COMPONENT_LINK_SERVICE,
diff --git a/drivers/gpu/drm/amd/dal/link_service/link_service.c b/drivers/gpu/drm/amd/dal/link_service/link_service.c
index 97034a5..8d64b74 100644
--- a/drivers/gpu/drm/amd/dal/link_service/link_service.c
+++ b/drivers/gpu/drm/amd/dal/link_service/link_service.c
@@ -46,7 +46,8 @@ static bool enable_stream(struct link_service *ls,
 	enum signal_type signal;
 
 	ASSERT(ls->strm_state == STREAM_STATE_DISABLED ||
-		ls->strm_state == STREAM_STATE_OPTIMIZED_READY);
+		ls->strm_state == STREAM_STATE_OPTIMIZED_READY ||
+		ls->strm_state == STREAM_STATE_POWER_SAVE);
 
 	if (ls->strm_state == STREAM_STATE_ACTIVE ||
 		ls->strm_state == STREAM_STATE_ENABLED)
-- 
1.9.1

