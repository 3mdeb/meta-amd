From f35b87454e79bac2b8af510545d3197b382591d4 Mon Sep 17 00:00:00 2001
From: Harry Wentland <harry.wentland@amd.com>
Date: Thu, 30 Jul 2015 14:32:24 -0400
Subject: [PATCH 378/401] drm/amdgpu: Correctly translate vblank irq src

Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Reviewed-by: Jordan Lazare <jordan.lazare@amd.com>
Reviewed-by: Vitaly Prosyak <vitaly.prosyak@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_dm_irq.c | 25 +++----------------------
 1 file changed, 3 insertions(+), 22 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_irq.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_irq.c
index fc1b120..ea55565 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_irq.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_dm_irq.c
@@ -567,27 +567,6 @@ static enum dal_irq_source amdgpu_dm_hpd_to_dal_irq_source(unsigned type)
 	}
 }
 
-static enum dal_irq_source amdgpu_dm_crtc_to_dal_irq_source(
-	unsigned type)
-{
-	switch (type) {
-	case AMDGPU_CRTC_IRQ_VBLANK1:
-		return DAL_IRQ_SOURCE_CRTC1VSYNC;
-	case AMDGPU_CRTC_IRQ_VBLANK2:
-		return DAL_IRQ_SOURCE_CRTC2VSYNC;
-	case AMDGPU_CRTC_IRQ_VBLANK3:
-		return DAL_IRQ_SOURCE_CRTC3VSYNC;
-	case AMDGPU_CRTC_IRQ_VBLANK4:
-		return DAL_IRQ_SOURCE_CRTC4VSYNC;
-	case AMDGPU_CRTC_IRQ_VBLANK5:
-		return DAL_IRQ_SOURCE_CRTC5VSYNC;
-	case AMDGPU_CRTC_IRQ_VBLANK6:
-		return DAL_IRQ_SOURCE_CRTC6VSYNC;
-	default:
-		return DAL_IRQ_SOURCE_INVALID;
-	}
-}
-
 static int amdgpu_dm_set_hpd_irq_state(struct amdgpu_device *adev,
 					struct amdgpu_irq_src *source,
 					unsigned type,
@@ -621,7 +600,9 @@ static int amdgpu_dm_set_crtc_irq_state(struct amdgpu_device *adev,
 					unsigned type,
 					enum amdgpu_interrupt_state state)
 {
-	enum dal_irq_source src = amdgpu_dm_crtc_to_dal_irq_source(type);
+	enum dal_irq_source src = dal_get_vblank_irq_src_from_display_index(
+			adev->dm.dal,
+			type);
 	bool st = (state == AMDGPU_IRQ_STATE_ENABLE);
 
 	dal_interrupt_set(adev->dm.dal, src, st);
-- 
1.9.1

