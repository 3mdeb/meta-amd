From 674dac77dc7da8896b8d4715eadac78929fd35e9 Mon Sep 17 00:00:00 2001
From: Tony Cheng <tony.cheng@amd.com>
Date: Fri, 16 Sep 2016 15:06:26 -0400
Subject: [PATCH 1095/1722] drm/amd/dal: refactor stream encoder macros

following same pattern as audio

Change-Id: Ib7f77880d78713c9ef3dc3ac41b3f0438516d2e5
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 .../gpu/drm/amd/dal/dc/dce100/dce100_resource.c    | 18 ++---
 .../gpu/drm/amd/dal/dc/dce110/dce110_resource.c    | 32 ++++----
 .../drm/amd/dal/dc/dce110/dce110_stream_encoder.h  | 91 +++++++++++-----------
 .../gpu/drm/amd/dal/dc/dce112/dce112_resource.c    | 19 ++---
 drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c  | 18 ++---
 5 files changed, 90 insertions(+), 88 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
index c894ab7..d84dfb3 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
@@ -289,9 +289,17 @@ static const struct dce110_link_enc_registers link_enc_regs[] = {
 	link_regs(6)
 };
 
+/* set register offset */
+#define SR(reg_name)\
+	.reg_name = mm ## reg_name
+
+/* set register offset with instance */
+#define SRI(reg_name, block, id)\
+	.reg_name = mm ## block ## id ## _ ## reg_name
+
 #define stream_enc_regs(id)\
 [id] = {\
-	SE_COMMON_REG_LIST(id)\
+	SE_COMMON_REG_LIST_BASE(id),\
 	.AFMT_CNTL = 0,\
 }
 
@@ -305,14 +313,6 @@ static const struct dce110_stream_enc_registers stream_enc_regs[] = {
 	stream_enc_regs(6)
 };
 
-/* set register offset */
-#define SR(reg_name)\
-	.reg_name = mm ## reg_name
-
-/* set register offset with instance */
-#define SRI(reg_name, block, id)\
-	.reg_name = mm ## block ## id ## _ ## reg_name
-
 #define audio_regs(id)\
 [id] = {\
 	AUD_COMMON_REG_LIST(id)\
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
index 3b6326d..7eeb700 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
@@ -242,22 +242,6 @@ static const struct dce110_link_enc_registers link_enc_regs[] = {
 		link_regs(6)
 };
 
-#define stream_enc_regs(id)\
-[id] = {\
-	SE_COMMON_REG_LIST(id)\
-	.AFMT_CNTL = mmDIG ## id ## _AFMT_CNTL,\
-}
-
-static const struct dce110_stream_enc_registers stream_enc_regs[] = {
-		stream_enc_regs(0),
-		stream_enc_regs(1),
-		stream_enc_regs(2),
-		stream_enc_regs(3),
-		stream_enc_regs(4),
-		stream_enc_regs(5),
-		stream_enc_regs(6)
-};
-
 /* set register offset */
 #define SR(reg_name)\
 	.reg_name = mm ## reg_name
@@ -266,6 +250,22 @@ static const struct dce110_stream_enc_registers stream_enc_regs[] = {
 #define SRI(reg_name, block, id)\
 	.reg_name = mm ## block ## id ## _ ## reg_name
 
+
+#define stream_enc_regs(id)\
+[id] = {\
+	SE_COMMON_REG_LIST(id)\
+}
+
+static const struct dce110_stream_enc_registers stream_enc_regs[] = {
+	stream_enc_regs(0),
+	stream_enc_regs(1),
+	stream_enc_regs(2),
+	stream_enc_regs(3),
+	stream_enc_regs(4),
+	stream_enc_regs(5),
+	stream_enc_regs(6),
+};
+
 #define audio_regs(id)\
 [id] = {\
 	AUD_COMMON_REG_LIST(id)\
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.h b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.h
index 325f807..59a701a 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.h
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_stream_encoder.h
@@ -31,53 +31,54 @@
 #define DCE110STRENC_FROM_STRENC(stream_encoder)\
 	container_of(stream_encoder, struct dce110_stream_encoder, base)
 
-#define SE_REG(reg_name, block_prefix, id)\
-	.reg_name = block_prefix ## id ## _ ## reg_name\
+#define SE_COMMON_REG_LIST_BASE(id) \
+	SRI(AFMT_AVI_INFO0, DIG, id), \
+	SRI(AFMT_AVI_INFO1, DIG, id), \
+	SRI(AFMT_AVI_INFO2, DIG, id), \
+	SRI(AFMT_AVI_INFO3, DIG, id), \
+	SRI(AFMT_GENERIC_0, DIG, id), \
+	SRI(AFMT_GENERIC_7, DIG, id), \
+	SRI(AFMT_GENERIC_HDR, DIG, id), \
+	SRI(AFMT_INFOFRAME_CONTROL0, DIG, id), \
+	SRI(AFMT_VBI_PACKET_CONTROL, DIG, id), \
+	SRI(AFMT_AUDIO_PACKET_CONTROL, DIG, id), \
+	SRI(AFMT_AUDIO_PACKET_CONTROL2, DIG, id), \
+	SRI(AFMT_AUDIO_SRC_CONTROL, DIG, id), \
+	SRI(AFMT_60958_0, DIG, id), \
+	SRI(AFMT_60958_1, DIG, id), \
+	SRI(AFMT_60958_2, DIG, id), \
+	SRI(DIG_FE_CNTL, DIG, id), \
+	SRI(HDMI_CONTROL, DIG, id), \
+	SRI(HDMI_GC, DIG, id), \
+	SRI(HDMI_GENERIC_PACKET_CONTROL0, DIG, id), \
+	SRI(HDMI_GENERIC_PACKET_CONTROL1, DIG, id), \
+	SRI(HDMI_INFOFRAME_CONTROL0, DIG, id), \
+	SRI(HDMI_INFOFRAME_CONTROL1, DIG, id), \
+	SRI(HDMI_VBI_PACKET_CONTROL, DIG, id), \
+	SRI(HDMI_AUDIO_PACKET_CONTROL, DIG, id),\
+	SRI(HDMI_ACR_PACKET_CONTROL, DIG, id),\
+	SRI(HDMI_ACR_32_0, DIG, id),\
+	SRI(HDMI_ACR_32_1, DIG, id),\
+	SRI(HDMI_ACR_44_0, DIG, id),\
+	SRI(HDMI_ACR_44_1, DIG, id),\
+	SRI(HDMI_ACR_48_0, DIG, id),\
+	SRI(HDMI_ACR_48_1, DIG, id),\
+	SRI(TMDS_CNTL, DIG, id), \
+	SRI(DP_MSE_RATE_CNTL, DP, id), \
+	SRI(DP_MSE_RATE_UPDATE, DP, id), \
+	SRI(DP_PIXEL_FORMAT, DP, id), \
+	SRI(DP_SEC_CNTL, DP, id), \
+	SRI(DP_STEER_FIFO, DP, id), \
+	SRI(DP_VID_M, DP, id), \
+	SRI(DP_VID_N, DP, id), \
+	SRI(DP_VID_STREAM_CNTL, DP, id), \
+	SRI(DP_VID_TIMING, DP, id), \
+	SRI(DP_SEC_AUD_N, DP, id), \
+	SRI(DP_SEC_TIMESTAMP, DP, id)
 
 #define SE_COMMON_REG_LIST(id)\
-	.AFMT_AVI_INFO0 = mmDIG ## id ## _AFMT_AVI_INFO0,\
-	.AFMT_AVI_INFO1 = mmDIG ## id ## _AFMT_AVI_INFO1,\
-	.AFMT_AVI_INFO2 = mmDIG ## id ## _AFMT_AVI_INFO2,\
-	.AFMT_AVI_INFO3 = mmDIG ## id ## _AFMT_AVI_INFO3,\
-	.AFMT_GENERIC_0 = mmDIG ## id ## _AFMT_GENERIC_0,\
-	.AFMT_GENERIC_7 = mmDIG ## id ## _AFMT_GENERIC_7,\
-	.AFMT_GENERIC_HDR = mmDIG ## id ## _AFMT_GENERIC_HDR,\
-	.AFMT_INFOFRAME_CONTROL0 = mmDIG ## id ## _AFMT_INFOFRAME_CONTROL0,\
-	.AFMT_VBI_PACKET_CONTROL = mmDIG ## id ## _AFMT_VBI_PACKET_CONTROL,\
-	.AFMT_AUDIO_PACKET_CONTROL = mmDIG ## id ## _AFMT_AUDIO_PACKET_CONTROL,\
-	.AFMT_AUDIO_PACKET_CONTROL2 = mmDIG ## id ## _AFMT_AUDIO_PACKET_CONTROL2,\
-	.AFMT_AUDIO_SRC_CONTROL = mmDIG ## id ## _AFMT_AUDIO_SRC_CONTROL,\
-	.AFMT_60958_0 = mmDIG ## id ## _AFMT_60958_0,\
-	.AFMT_60958_1 = mmDIG ## id ## _AFMT_60958_1,\
-	.AFMT_60958_2 = mmDIG ## id ## _AFMT_60958_2,\
-	.DIG_FE_CNTL = mmDIG ## id ## _DIG_FE_CNTL,\
-	.DP_MSE_RATE_CNTL = mmDP ## id ## _DP_MSE_RATE_CNTL,\
-	.DP_MSE_RATE_UPDATE = mmDP ## id ## _DP_MSE_RATE_UPDATE,\
-	.DP_PIXEL_FORMAT = mmDP ## id ## _DP_PIXEL_FORMAT,\
-	.DP_SEC_CNTL = mmDP ## id ## _DP_SEC_CNTL,\
-	.DP_STEER_FIFO = mmDP ## id ## _DP_STEER_FIFO,\
-	.DP_VID_M = mmDP ## id ## _DP_VID_M,\
-	.DP_VID_N = mmDP ## id ## _DP_VID_N,\
-	.DP_VID_STREAM_CNTL = mmDP ## id ## _DP_VID_STREAM_CNTL,\
-	.DP_VID_TIMING = mmDP ## id ## _DP_VID_TIMING,\
-	.DP_SEC_AUD_N = mmDP ## id ## _DP_SEC_AUD_N,\
-	.DP_SEC_TIMESTAMP = mmDP ## id ## _DP_SEC_TIMESTAMP,\
-	.HDMI_CONTROL = mmDIG ## id ## _HDMI_CONTROL,\
-	.HDMI_GC = mmDIG ## id ## _HDMI_GC,\
-	.HDMI_GENERIC_PACKET_CONTROL0 = mmDIG ## id ## _HDMI_GENERIC_PACKET_CONTROL0,\
-	.HDMI_GENERIC_PACKET_CONTROL1 = mmDIG ## id ## _HDMI_GENERIC_PACKET_CONTROL1,\
-	.HDMI_INFOFRAME_CONTROL0 = mmDIG ## id ## _HDMI_INFOFRAME_CONTROL0,\
-	.HDMI_INFOFRAME_CONTROL1 = mmDIG ## id ## _HDMI_INFOFRAME_CONTROL1,\
-	.HDMI_VBI_PACKET_CONTROL = mmDIG ## id ## _HDMI_VBI_PACKET_CONTROL,\
-	SE_REG(HDMI_AUDIO_PACKET_CONTROL, mmDIG, id),\
-	SE_REG(HDMI_ACR_PACKET_CONTROL, mmDIG, id),\
-	SE_REG(HDMI_ACR_32_0, mmDIG, id),\
-	SE_REG(HDMI_ACR_32_1, mmDIG, id),\
-	SE_REG(HDMI_ACR_44_0, mmDIG, id),\
-	SE_REG(HDMI_ACR_44_1, mmDIG, id),\
-	SE_REG(HDMI_ACR_48_0, mmDIG, id),\
-	SE_REG(HDMI_ACR_48_1, mmDIG, id),\
-	.TMDS_CNTL = mmDIG ## id ## _TMDS_CNTL,
+	SE_COMMON_REG_LIST_BASE(id), \
+	SRI(AFMT_CNTL, DIG, id)
 
 struct dce110_stream_enc_registers {
 	uint32_t AFMT_CNTL;
diff --git a/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c b/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c
index 57e72ba..65e7b31 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c
@@ -284,10 +284,19 @@ static const struct dce110_link_enc_registers link_enc_regs[] = {
 	link_regs(4),
 	link_regs(5)
 };
+
+/* set register offset */
+#define SR(reg_name)\
+	.reg_name = mm ## reg_name
+
+/* set register offset with instance */
+#define SRI(reg_name, block, id)\
+	.reg_name = mm ## block ## id ## _ ## reg_name
+
+
 #define stream_enc_regs(id)\
 [id] = {\
 	SE_COMMON_REG_LIST(id)\
-	.AFMT_CNTL = mmDIG ## id ## _AFMT_CNTL,\
 }
 
 static const struct dce110_stream_enc_registers stream_enc_regs[] = {
@@ -299,14 +308,6 @@ static const struct dce110_stream_enc_registers stream_enc_regs[] = {
 	stream_enc_regs(5)
 };
 
-/* set register offset */
-#define SR(reg_name)\
-	.reg_name = mm ## reg_name
-
-/* set register offset with instance */
-#define SRI(reg_name, block, id)\
-	.reg_name = mm ## block ## id ## _ ## reg_name
-
 #define audio_regs(id)\
 [id] = {\
 	AUD_COMMON_REG_LIST(id)\
diff --git a/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c b/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c
index 5e8c3f3..476774d 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c
@@ -270,9 +270,17 @@ static const struct dce110_link_enc_registers link_enc_regs[] = {
 	link_regs(5)
 };
 
+/* set register offset */
+#define SR(reg_name)\
+	.reg_name = mm ## reg_name
+
+/* set register offset with instance */
+#define SRI(reg_name, block, id)\
+	.reg_name = mm ## block ## id ## _ ## reg_name
+
 #define stream_enc_regs(id)\
 [id] = {\
-	SE_COMMON_REG_LIST(id)\
+	SE_COMMON_REG_LIST_BASE(id),\
 	.AFMT_CNTL = 0,\
 }
 
@@ -290,14 +298,6 @@ static const struct dce110_stream_enc_registers stream_enc_regs[] = {
 	AUD_COMMON_REG_LIST(id)\
 }
 
-/* set register offset */
-#define SR(reg_name)\
-	.reg_name = mm ## reg_name
-
-/* set register offset with instance */
-#define SRI(reg_name, block, id)\
-	.reg_name = mm ## block ## id ## _ ## reg_name
-
 static const struct dce110_audio_registers audio_regs[] = {
 	audio_regs(0),
 	audio_regs(1),
-- 
2.7.4

