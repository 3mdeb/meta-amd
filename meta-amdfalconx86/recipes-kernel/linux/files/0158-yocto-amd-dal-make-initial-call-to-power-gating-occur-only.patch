From 205841d3f5d605bae009e9a5f9f4b87740938bfd Mon Sep 17 00:00:00 2001
From: Mykola Lysenko <mykola.lysenko@amd.com>
Date: Mon, 15 Jun 2015 05:53:43 -0400
Subject: [PATCH 272/343] amd/dal: make initial call to power gating occur only
 once

Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Reviewed-by: Yeh, Eagle <Eagle.Yeh@amd.com>
Reviewed-by: Rokhvarg, David <David.Rokhvarg@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 drivers/gpu/drm/amd/dal/topology/topology.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/dal/topology/topology.c b/drivers/gpu/drm/amd/dal/topology/topology.c
index 8b64077..2857037 100644
--- a/drivers/gpu/drm/amd/dal/topology/topology.c
+++ b/drivers/gpu/drm/amd/dal/topology/topology.c
@@ -1288,6 +1288,7 @@ static void tm_update_audio_connectivity(struct topology_mgr *tm)
 static void tm_reset_controllers(struct topology_mgr *tm)
 {
 	uint32_t i;
+	uint32_t controller_index = 0;
 	struct tm_resource *tm_resource;
 	struct tm_resource_controller_info *controller_info;
 	struct controller *controller;
@@ -1309,7 +1310,8 @@ static void tm_reset_controllers(struct topology_mgr *tm)
 
 		controller = controller_info->controller;
 
-		if (asic_runtime_flags.bits.GNB_WAKEUP_SUPPORTED == 1)
+		if (controller_index == 0 &&
+			asic_runtime_flags.bits.GNB_WAKEUP_SUPPORTED == 1)
 			dal_controller_power_gating_enable(controller,
 					PIPE_GATING_CONTROL_INIT);
 
@@ -1322,6 +1324,8 @@ static void tm_reset_controllers(struct topology_mgr *tm)
 
 		dal_controller_enable_display_pipe_clock_gating(controller,
 				true);
+
+		++controller_index;
 	}
 }
 
-- 
1.9.1

