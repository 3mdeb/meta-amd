From b4562e6a742548bdfa10f4a664a753a346ace5f3 Mon Sep 17 00:00:00 2001
From: Chandu Babu N <chandu@amd.com>
Date: Thu, 22 Jun 2017 10:48:41 +0530
Subject: [PATCH 02/14] st/va: Fix leak in VAAPI subpictures
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

sampler view allocated in vaAssociateSubpicture is not cleared
in vaiDeassociateSubpicture.

Reviewed-by: Christian KÃ¶nig <christian.koenig@amd.com>
---
 src/gallium/state_trackers/va/subpicture.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/gallium/state_trackers/va/subpicture.c b/src/gallium/state_trackers/va/subpicture.c
index 15d52b9..981a99c 100644
--- a/src/gallium/state_trackers/va/subpicture.c
+++ b/src/gallium/state_trackers/va/subpicture.c
@@ -283,6 +283,7 @@ vlVaDeassociateSubpicture(VADriverContextP ctx, VASubpictureID subpicture,
       while (surf->subpics.size && util_dynarray_top(&surf->subpics, vlVaSubpicture *) == NULL)
          (void)util_dynarray_pop(&surf->subpics, vlVaSubpicture *);
    }
+   pipe_sampler_view_reference(&sub->sampler,NULL);
    mtx_unlock(&drv->mutex);
 
    return VA_STATUS_SUCCESS;
-- 
2.7.4

