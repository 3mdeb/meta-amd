From 328011918ecdbdd8e910b7fa81ecbf58fe2958d2 Mon Sep 17 00:00:00 2001
From: Aric Cyr <aric.cyr@amd.com>
Date: Tue, 10 May 2016 20:28:03 -0400
Subject: [PATCH 0477/1722] drm/amd/dal: Expose correct number of underlays to
 DM

Signed-off-by: Aric Cyr <Aric.Cyr@amd.com>
Acked-by: Jordan Lazare <Jordan.Lazare@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/dc.h                     | 1 +
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/drivers/gpu/drm/amd/dal/dc/dc.h b/drivers/gpu/drm/amd/dal/dc/dc.h
index 490f95d..ec1d4c4 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc.h
@@ -45,6 +45,7 @@ struct dc_caps {
 	uint32_t max_targets;
 	uint32_t max_links;
 	uint32_t max_audios;
+	uint32_t max_underlays;
 };
 
 struct dc;
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
index 046c427..a361d50 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
@@ -901,6 +901,9 @@ static void underlay_create(struct dc_context *ctx, struct resource_pool *pool)
 			pool->transforms[pool->pipe_count],
 			pool->scaler_filter);
 	pool->pipe_count++;
+
+	// update the public caps to indicate an underlay is available
+	ctx->dc->caps.max_underlays = 1;
 }
 
 static void bw_calcs_data_update_from_pplib(struct core_dc *dc)
-- 
2.7.4

