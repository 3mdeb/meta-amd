From 055c66fc1ad75d4f918f77dffce7d53a8bf54157 Mon Sep 17 00:00:00 2001
From: Mykola Lysenko <mykola.lysenko@amd.com>
Date: Mon, 15 Jun 2015 06:46:46 -0400
Subject: [PATCH 277/401] amd/dal: make proper gamma programming for 8 bits

Port of CL1160416

Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Reviewed-by: Yeh, Eagle <Eagle.Yeh@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 .../gpu/drm/amd/dal/controller/dce110/grph_gamma_dce110.c   | 13 ++++++-------
 1 file changed, 6 insertions(+), 7 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/controller/dce110/grph_gamma_dce110.c b/drivers/gpu/drm/amd/dal/controller/dce110/grph_gamma_dce110.c
index b988cc2..be25699 100644
--- a/drivers/gpu/drm/amd/dal/controller/dce110/grph_gamma_dce110.c
+++ b/drivers/gpu/drm/amd/dal/controller/dce110/grph_gamma_dce110.c
@@ -1440,13 +1440,12 @@ static void program_prescale_legacy(
 	break;
 
 	case PIXEL_FORMAT_ARGB8888:
-		prescale_num = 1;
-		/* set default by pass */
-		set_reg_field_value(
-			prescale_control,
-			1,
-			PRESCALE_GRPH_CONTROL,
-			GRPH_PRESCALE_BYPASS);
+		/* This function should only be called when using regamma
+		 * and bypassing legacy INPUT GAMMA LUT (function name is
+		 * misleading)
+		 */
+		prescale_num = 256;
+		prescale_denom = 255;
 	break;
 
 	case PIXEL_FORMAT_ARGB2101010:
-- 
1.9.1

