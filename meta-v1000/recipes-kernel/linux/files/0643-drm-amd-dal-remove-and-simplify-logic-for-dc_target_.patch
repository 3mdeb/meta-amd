From d612e4663c417bf8ff8da3fe441ebbcb40ef903f Mon Sep 17 00:00:00 2001
From: Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>
Date: Wed, 13 Jul 2016 12:02:49 -0400
Subject: [PATCH 0643/1722] drm/amd/dal: remove and simplify logic for
 dc_target_get_irq_src

Signed-off-by: Dmytro Laktyushkin <Dmytro.Laktyushkin@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_irq.c | 12 ++++++------
 drivers/gpu/drm/amd/dal/dc/core/dc_target.c       | 19 -------------------
 drivers/gpu/drm/amd/dal/dc/dc.h                   |  5 -----
 3 files changed, 6 insertions(+), 30 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_irq.c b/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_irq.c
index d19c5bd..ff755a9 100644
--- a/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_irq.c
+++ b/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_irq.c
@@ -696,15 +696,15 @@ static inline int dm_irq_state(
 
 	struct amdgpu_crtc *acrtc = adev->mode_info.crtcs[crtc_id];
 
-	if (!acrtc || !acrtc->target) {
-		DRM_INFO(
-			"%s: target is null for crtc %d, talk to David R\n",
-			func,
-			crtc_id);
+	if (!acrtc) {
+		DRM_ERROR(
+			"%s: crtc is NULL at id :%d\n",
+	 		func,
+	 		crtc_id);
 		return 0;
 	}
 
-	irq_source = dc_target_get_irq_src(adev->dm.dc, acrtc->target, dal_irq_type);
+	irq_source = dal_irq_type + acrtc->otg_inst;
 
 	st = (state == AMDGPU_IRQ_STATE_ENABLE);
 
diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc_target.c b/drivers/gpu/drm/amd/dal/dc/core/dc_target.c
index d9f9cef..bfc94d7 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc_target.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc_target.c
@@ -283,25 +283,6 @@ uint32_t dc_target_get_scanoutpos(
 	return 0;
 }
 
-enum dc_irq_source dc_target_get_irq_src(
-	const struct dc *dc,
-	const struct dc_target *dc_target,
-	const enum irq_type irq_type)
-{
-	struct core_dc *core_dc = DC_TO_CORE(dc);
-
-	uint8_t i;
-	struct core_target *core_target = DC_TARGET_TO_CORE(dc_target);
-	struct core_stream *stream =
-			DC_STREAM_TO_CORE(core_target->public.streams[0]);
-
-	for (i = 0; i < MAX_PIPES; i++)
-		if (core_dc->current_context->res_ctx.pipe_ctx[i].stream == stream)
-			return irq_type + i;
-
-	return irq_type;
-}
-
 void dc_target_log(
 	const struct dc_target *dc_target,
 	struct dal_logger *dal_logger,
diff --git a/drivers/gpu/drm/amd/dal/dc/dc.h b/drivers/gpu/drm/amd/dal/dc/dc.h
index a54cd77..478c8d9 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc.h
@@ -284,11 +284,6 @@ uint32_t dc_target_get_scanoutpos(
 		uint32_t *vbl,
 		uint32_t *position);
 
-enum dc_irq_source dc_target_get_irq_src(
-	const struct dc *dc,
-	const struct dc_target *dc_target,
-	const enum irq_type irq_type);
-
 /*
  * Structure to store surface/target associations for validation
  */
-- 
2.7.4

