From 3d1d283fd2f21f61f112107adcc4d3ac73427c30 Mon Sep 17 00:00:00 2001
From: David Rokhvarg <David.Rokhvarg@amd.com>
Date: Thu, 11 Jun 2015 16:14:59 -0400
Subject: [PATCH 270/343] drm/amdgpu: [DM] Implemented Register Logger
 facility.

Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Reviewed-by: Eagle Yeh <Eagle.Yeh@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_dal_services.c | 18 +++++++++++++++++-
 1 file changed, 17 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_dal_services.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_dal_services.c
index e404521..9b08f44 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_dal_services.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_dal_services.c
@@ -53,7 +53,16 @@ uint32_t dal_read_reg(
 	struct dal_context *ctx,
 	uint32_t address)
 {
-	return amdgpu_mm_rreg(ctx->driver_context, address, false);
+	uint32_t value = amdgpu_mm_rreg(ctx->driver_context, address, false);
+
+#if defined(__DAL_REGISTER_LOGGER__)
+	if (true == dal_reg_logger_should_dump_register()) {
+		dal_reg_logger_rw_count_increment();
+		DRM_INFO("%s 0x%x 0x%x\n", __func__, address, value);
+	}
+#endif
+
+	return value;
 }
 
 
@@ -62,6 +71,13 @@ void dal_write_reg(
 	uint32_t address,
 	uint32_t value)
 {
+#if defined(__DAL_REGISTER_LOGGER__)
+	if (true == dal_reg_logger_should_dump_register()) {
+		dal_reg_logger_rw_count_increment();
+		DRM_INFO("%s 0x%x 0x%x\n", __func__, address, value);
+	}
+#endif
+
 	amdgpu_mm_wreg(ctx->driver_context, address, value, false);
 }
 
-- 
1.9.1

