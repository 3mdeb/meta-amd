From c6bb3a4d53fcfa46f23538f893d28e107ceeb9c9 Mon Sep 17 00:00:00 2001
From: Amy Zhang <Amy.Zhang@amd.com>
Date: Thu, 2 Jun 2016 15:22:45 -0400
Subject: [PATCH 0520/1722] drm/amd/dal: VSR downscale limit added to dc
 resources

Signed-off-by: Amy Zhang <Amy.Zhang@amd.com>
Acked-by: Jordan Lazare <Jordan.Lazare@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc.c                | 4 ----
 drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c | 6 +++++-
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c | 2 ++
 drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c | 1 +
 drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c   | 1 +
 5 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc.c b/drivers/gpu/drm/amd/dal/dc/core/dc.c
index 4aee4c1..dec1b3b 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc.c
@@ -433,10 +433,6 @@ struct dc *dc_create(const struct dc_init_data *init_params)
 			core_dc->res_pool.stream_enc_count);
 	core_dc->public.caps.max_links = core_dc->link_count;
 	core_dc->public.caps.max_audios = core_dc->res_pool.audio_count;
-        if (core_dc->res_pool->adapter_srv)
-                core_dc->public.caps.max_downscale_ratio =
-                        dal_adapter_service_get_downscale_limit(
-                                        core_dc->res_pool->adapter_srv);
 
 	dal_logger_write(core_dc->ctx->logger,
 			LOG_MAJOR_INTERFACE_TRACE,
diff --git a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
index 7c56f92..ee55e02 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
@@ -810,11 +810,15 @@ bool dce100_construct_resource_pool(
 			goto irqs_create_fail;
 
 	}
-
+        /*************************************************
+        *  Resource + asic cap harcoding                *
+        *************************************************/
 	pool->pipe_count = dal_adapter_service_get_func_controllers_num(as);
 	pool->stream_enc_count = dal_adapter_service_get_stream_engines_num(as);
 	pool->scaler_filter = dal_scaler_filter_create(ctx);
+        dc->public.caps.max_downscale_ratio = 200;
 
+	
 	if (pool->scaler_filter == NULL) {
 		BREAK_TO_DEBUGGER();
 		dm_error("DC: failed to create filter!\n");
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
index e1b426e..27d20c9 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_resource.c
@@ -1029,6 +1029,8 @@ bool dce110_construct_resource_pool(
 	 *************************************************/
 	pool->pipe_count = 3;
 	pool->stream_enc_count = 3;
+ 
+        dc->public.caps.max_downscale_ratio = 150;
 
 	/*************************************************
 	 *  Create resources                             *
diff --git a/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c b/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c
index 1aeabdd..0f2bc3f 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce112/dce112_resource.c
@@ -1059,6 +1059,7 @@ bool dce112_construct_resource_pool(
 	pool->pipe_count =
 		dal_adapter_service_get_func_controllers_num(adapter_serv);
 	pool->stream_enc_count = dal_adapter_service_get_stream_engines_num(adapter_serv);
+        dc->public.caps.max_downscale_ratio = 200;
 
 	/*************************************************
 	 *  Create resources                             *
diff --git a/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c b/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c
index c1d57f3..3707ea1 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce80/dce80_resource.c
@@ -706,6 +706,7 @@ bool dce80_construct_resource_pool(
 	 *************************************************/
 	pool->pipe_count = dal_adapter_service_get_func_controllers_num(as);
 	pool->stream_enc_count = dal_adapter_service_get_stream_engines_num(as);
+        dc->public.caps.max_downscale_ratio = 200;
 
 	/*************************************************
 	 *  Create resources                             *
-- 
2.7.4

