From 5b3a92e247874b64f14e7b7288949e4fc7642417 Mon Sep 17 00:00:00 2001
From: Tom St Denis <tom.stdenis@amd.com>
Date: Thu, 10 Nov 2016 08:14:19 -0500
Subject: [PATCH 1450/1722] drm/amd/amdgpu: Fix gfxv6 driver issues from
 porting to new headers
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This patch fixes a couple of bugs that fell out from the porting
effort.

Signed-off-by: Tom St Denis <tom.stdenis@amd.com>
Reviewed-by: Christian KÃ¶nig <christian.koenig@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/gfx_v6_0.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/gfx_v6_0.c b/drivers/gpu/drm/amd/amdgpu/gfx_v6_0.c
index 440e347..9423501 100644
--- a/drivers/gpu/drm/amd/amdgpu/gfx_v6_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/gfx_v6_0.c
@@ -1607,10 +1607,10 @@ err1:
 static void gfx_v6_0_cp_gfx_enable(struct amdgpu_device *adev, bool enable)
 {
 	int i;
-	if (enable)
+	if (enable) {
 		WREG32(mmCP_ME_CNTL, 0);
-	else {
-		WREG32(mmCP_ME_CNTL, (CP_ME_CNTL__CE_HALT_MASK |
+	} else {
+		WREG32(mmCP_ME_CNTL, (CP_ME_CNTL__ME_HALT_MASK |
 				      CP_ME_CNTL__PFP_HALT_MASK |
 				      CP_ME_CNTL__CE_HALT_MASK));
 		WREG32(mmSCRATCH_UMSK, 0);
@@ -1899,6 +1899,7 @@ static int gfx_v6_0_cp_compute_resume(struct amdgpu_device *adev)
 		r = amdgpu_ring_test_ring(&adev->gfx.compute_ring[i]);
 		if (r)
 			return r;
+		adev->gfx.compute_ring[i].ready = true;
 	}
 
 	return 0;
-- 
2.7.4

