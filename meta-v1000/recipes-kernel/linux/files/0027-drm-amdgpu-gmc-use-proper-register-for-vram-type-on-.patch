From d480c8796683fdec7443401870e0cd1ed32806d4 Mon Sep 17 00:00:00 2001
From: Alex Deucher <alexander.deucher@amd.com>
Date: Thu, 31 Mar 2016 16:41:32 -0400
Subject: [PATCH 0027/1722] drm/amdgpu/gmc: use proper register for vram type
 on Fiji

The offset changed on Fiji.

Reviewed-by: Harish Kasiviswanathan <Harish.Kasiviswanathan@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Cc: stable@vger.kernel.org
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/gmc_v8_0.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/gmc_v8_0.c b/drivers/gpu/drm/amd/amdgpu/gmc_v8_0.c
index 6aa3207..88f88b2 100644
--- a/drivers/gpu/drm/amd/amdgpu/gmc_v8_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/gmc_v8_0.c
@@ -922,7 +922,12 @@ static int gmc_v8_0_sw_init(void *handle)
         if (adev->flags & AMD_IS_APU) {
                 adev->mc.vram_type = AMDGPU_VRAM_TYPE_UNKNOWN;
         } else {
-                u32 tmp = RREG32(mmMC_SEQ_MISC0);
+                u32 tmp;
+ 
+                if (adev->asic_type == CHIP_FIJI)
+                        tmp = RREG32(mmMC_SEQ_MISC0_FIJI);
+                else
+                        tmp = RREG32(mmMC_SEQ_MISC0);
                 tmp &= MC_SEQ_MISC0__MT__MASK;
                 adev->mc.vram_type = gmc_v8_0_convert_vram_type(tmp);
         }
-- 
2.7.4

