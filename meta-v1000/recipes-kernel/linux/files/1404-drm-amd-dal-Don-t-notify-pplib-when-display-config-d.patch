From 00133c92c87e2a522b711710d9aff6e933419ec7 Mon Sep 17 00:00:00 2001
From: Logatharshan Thothiralingam <logatharshan.thothiralingam@amd.com>
Date: Fri, 21 Oct 2016 16:06:39 -0400
Subject: [PATCH 1404/1722] drm/amd/dal: Don't notify pplib when display config
 didn't change

Change-Id: I799b32afa70156dede11e4271acfb15ed6cd9b63
Signed-off-by: Logatharshan Thothiralingam <logatharshan.thothiralingam@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc.c     | 9 +++++++--
 drivers/gpu/drm/amd/dal/dc/inc/core_dc.h | 5 +++++
 2 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc.c b/drivers/gpu/drm/amd/dal/dc/core/dc.c
index 9512a9c..e039cc4 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc.c
@@ -976,7 +976,7 @@ static int determine_sclk_from_bounding_box(
 }
 
 void pplib_apply_display_requirements(
-	const struct core_dc *dc,
+	struct core_dc *dc,
 	const struct validate_context *context,
 	struct dm_pp_display_configuration *pp_display_cfg)
 {
@@ -1021,7 +1021,12 @@ void pplib_apply_display_requirements(
 							/ timing->pix_clk_khz;
 	}
 
-	dm_pp_apply_display_requirements(dc->ctx, pp_display_cfg);
+	if (memcmp(&dc->prev_display_config, pp_display_cfg, sizeof(
+			struct dm_pp_display_configuration)) !=  0)
+		dm_pp_apply_display_requirements(dc->ctx, pp_display_cfg);
+
+	dc->prev_display_config = *pp_display_cfg;
+
 }
 
 bool dc_commit_targets(
diff --git a/drivers/gpu/drm/amd/dal/dc/inc/core_dc.h b/drivers/gpu/drm/amd/dal/dc/inc/core_dc.h
index 6c4f9e1..826ae7a 100644
--- a/drivers/gpu/drm/amd/dal/dc/inc/core_dc.h
+++ b/drivers/gpu/drm/amd/dal/dc/inc/core_dc.h
@@ -39,6 +39,11 @@ struct core_dc {
 
 	/* HW functions */
 	struct hw_sequencer_funcs hwss;
+
+	/* temp store of dm_pp_display_configuration
+	 * to compare to see if display config changed
+	 */
+	struct dm_pp_display_configuration prev_display_config;
 };
 
 #endif /* __CORE_DC_H__ */
-- 
2.7.4

