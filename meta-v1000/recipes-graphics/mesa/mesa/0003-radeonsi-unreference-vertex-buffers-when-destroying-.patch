From 17ee94768c5fb54a9b02de4dd859e29c5e923bca Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Marek=20Ol=C5=A1=C3=A1k?= <marek.olsak@amd.com>
Date: Wed, 21 Jun 2017 18:39:41 +0200
Subject: [PATCH 03/14] radeonsi: unreference vertex buffers when destroying
 the context

Reviewed-by: Samuel Pitoiset <samuel.pitoiset@gmail.com>
---
 src/gallium/drivers/radeonsi/si_descriptors.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/gallium/drivers/radeonsi/si_descriptors.c b/src/gallium/drivers/radeonsi/si_descriptors.c
index 7a2b71d..507a7ac 100644
--- a/src/gallium/drivers/radeonsi/si_descriptors.c
+++ b/src/gallium/drivers/radeonsi/si_descriptors.c
@@ -2224,6 +2224,8 @@ void si_release_all_descriptors(struct si_context *sctx)
 	}
 	si_release_buffer_resources(&sctx->rw_buffers,
 				    &sctx->descriptors[SI_DESCS_RW_BUFFERS]);
+	for (i = 0; i < SI_NUM_VERTEX_BUFFERS; i++)
+		pipe_vertex_buffer_unreference(&sctx->vertex_buffer[i]);
 
 	for (i = 0; i < SI_NUM_DESCS; ++i)
 		si_release_descriptors(&sctx->descriptors[i]);
-- 
2.7.4

