From a682dcaf9f7f4dc194ff62a9d78813d7fc0272e6 Mon Sep 17 00:00:00 2001
From: Harry Wentland <harry.wentland@amd.com>
Date: Tue, 26 Jul 2016 16:46:31 -0400
Subject: [PATCH 0669/1722] drm/amd/dal: Always use 10-bit linebuffer

8-bit linebuffer shows banding on some displays

Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc_resource.c | 22 +++++-----------------
 1 file changed, 5 insertions(+), 17 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c b/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
index 8518907..4397c3a 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
@@ -435,22 +435,6 @@ static void calculate_scaling_ratios(
 	}
 }
 
-void decide_lb_format(struct pipe_ctx *pipe_ctx)
-{
-	switch (pipe_ctx->pix_clk_params.color_depth) {
-	case COLOR_DEPTH_666:
-	case COLOR_DEPTH_888:
-		pipe_ctx->scl_data.lb_bpp = LB_PIXEL_DEPTH_24BPP;
-		break;
-	case COLOR_DEPTH_101010:
-		pipe_ctx->scl_data.lb_bpp = LB_PIXEL_DEPTH_30BPP;
-		break;
-	default:
-		pipe_ctx->scl_data.lb_bpp = LB_PIXEL_DEPTH_30BPP;
-		break;
-	}
-}
-
 bool resource_build_scaling_params(
 	const struct dc_surface *surface,
 	struct pipe_ctx *pipe_ctx)
@@ -471,7 +455,11 @@ bool resource_build_scaling_params(
 
 	calculate_recout(surface, pipe_ctx);
 
-	decide_lb_format(pipe_ctx);
+	/**
+	 * Setting line buffer pixel depth to 24bpp yields banding
+	 * on certain displays, such as the Sharp 4k
+	 */
+	pipe_ctx->scl_data.lb_bpp = LB_PIXEL_DEPTH_30BPP;
 
 	pipe_ctx->scl_data.h_active = timing->h_addressable
 			+ timing->h_border_left + timing->h_border_right;
-- 
2.7.4

