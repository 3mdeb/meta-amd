From 6ba51005a3c20fa64a2721c63ce17247784debe6 Mon Sep 17 00:00:00 2001
From: Mykola Lysenko <Mykola.Lysenko@amd.com>
Date: Thu, 3 Sep 2015 19:00:08 +0800
Subject: [PATCH 02/14] amd/dal: fix max nb pstate watermark value

Signed-off-by: Mykola Lysenko <Mykola.Lysenko@amd.com>
Reviewed-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 drivers/gpu/drm/amd/dal/gpu/dce110/bandwidth_manager_dce110.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/gpu/dce110/bandwidth_manager_dce110.c b/drivers/gpu/drm/amd/dal/gpu/dce110/bandwidth_manager_dce110.c
index c1c3f05..e03fadb 100644
--- a/drivers/gpu/drm/amd/dal/gpu/dce110/bandwidth_manager_dce110.c
+++ b/drivers/gpu/drm/amd/dal/gpu/dce110/bandwidth_manager_dce110.c
@@ -178,6 +178,7 @@ struct internal_funcs {
 
 #define MAX_OFFSETS_DCE110 3
 #define MAX_WATERMARK 0xFFFF
+#define MAX_NB_PSTATE_WATERMARK 0x7FFF
 
 static void program_pix_dur_crtc(
 	struct bandwidth_manager *bm,
@@ -4179,8 +4180,8 @@ static void nb_pstate_watermark(
 				__func__);
 
 		if (safe_mark) {
-			wm_high_clks = MAX_WATERMARK;
-			wm_low_clks = MAX_WATERMARK;
+			wm_high_clks = MAX_NB_PSTATE_WATERMARK;
+			wm_low_clks = MAX_NB_PSTATE_WATERMARK;
 		} else {
 			if (cur_wm_params == NULL) {
 				dal_logger_write(bm->dal_ctx->logger,
@@ -4233,8 +4234,8 @@ static void nb_pstate_watermark(
 			cur_wm_params->surface_pixel_format ==
 				PIXEL_FORMAT_422BPP16) {
 			if (safe_mark) {
-				wm_high_clks = MAX_WATERMARK;
-				wm_low_clks = MAX_WATERMARK;
+				wm_high_clks = MAX_NB_PSTATE_WATERMARK;
+				wm_low_clks = MAX_NB_PSTATE_WATERMARK;
 			} else {
 				struct bandwidth_params bw_chroma_param;
 
-- 
2.1.4

