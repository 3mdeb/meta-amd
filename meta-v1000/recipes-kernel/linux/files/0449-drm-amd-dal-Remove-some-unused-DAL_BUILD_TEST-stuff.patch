From d0bd7ab385c1f5198c13d2aa1e3baea21335b7d2 Mon Sep 17 00:00:00 2001
From: Harry Wentland <harry.wentland@amd.com>
Date: Fri, 6 May 2016 12:27:28 -0400
Subject: [PATCH 0449/1722] drm/amd/dal: Remove some unused DAL_BUILD_TEST
 stuff

And some other small cleanups

Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 .../dal/dc/asic_capability/tonga_asic_capability.c |   3 +-
 drivers/gpu/drm/amd/dal/dc/dc_types.h              |   4 -
 .../drm/amd/dal/dc/dce100/dce100_hw_sequencer.c    |  12 +--
 .../gpu/drm/amd/dal/dc/dce100/dce100_resource.c    |   1 -
 .../drm/amd/dal/dc/dce110/dce110_link_encoder.c    |   2 +-
 drivers/gpu/drm/amd/dal/dc/dm_services.h           |  12 ---
 drivers/gpu/drm/amd/dal/dc/dm_services_types.h     | 104 ---------------------
 .../drm/amd/dal/include/display_clock_interface.h  |   6 --
 drivers/gpu/drm/amd/dal/include/dpcd_defs.h        |   7 --
 drivers/gpu/drm/amd/dal/include/grph_object_id.h   |   2 -
 10 files changed, 9 insertions(+), 144 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/asic_capability/tonga_asic_capability.c b/drivers/gpu/drm/amd/dal/dc/asic_capability/tonga_asic_capability.c
index 880820c..ba024d3 100644
--- a/drivers/gpu/drm/amd/dal/dc/asic_capability/tonga_asic_capability.c
+++ b/drivers/gpu/drm/amd/dal/dc/asic_capability/tonga_asic_capability.c
@@ -89,7 +89,8 @@ void tonga_asic_capability_create(struct asic_capability *cap,
 	cap->stereo_3d_caps.DISPLAYPORT_FRAME_ALT = true;
 	cap->stereo_3d_caps.INTERLEAVE = true;
 
-	e_fuse_setting = dm_read_index_reg(cap->ctx, CGS_IND_REG__SMC, ixVCE_HARVEST_FUSE_MACRO__ADDRESS);
+	e_fuse_setting = dm_read_index_reg(cap->ctx, CGS_IND_REG__SMC,
+		ixVCE_HARVEST_FUSE_MACRO__ADDRESS);
 
 	/* Bits [28:27]*/
 	switch ((e_fuse_setting >> 27) & 0x3) {
diff --git a/drivers/gpu/drm/amd/dal/dc/dc_types.h b/drivers/gpu/drm/amd/dal/dc/dc_types.h
index 4d9b24a..2702b43 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc_types.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc_types.h
@@ -40,10 +40,6 @@ struct dc_link;
 struct dc_sink;
 struct dal;
 
-#if defined(BUILD_DAL_TEST)
-struct test_driver_context;
-#endif /* BUILD_DAL_TEST */
-
 /********************************
  * Environment definitions
  ********************************/
diff --git a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_hw_sequencer.c b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_hw_sequencer.c
index ef1afd3e..3e1e079 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_hw_sequencer.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_hw_sequencer.c
@@ -229,6 +229,12 @@ static bool dce100_enable_display_power_gating(
 		return false;
 }
 
+static void set_displaymarks(
+		const struct core_dc *dc, struct validate_context *context)
+{
+	/* Do nothing until we have proper bandwitdth calcs */
+}
+
 static void enable_hw_base_light_sleep(void)
 {
 	/* TODO: implement */
@@ -254,12 +260,6 @@ static void dal_dc_clock_gating_dce100_power_up(struct dc_context *ctx, bool ena
 	}
 }
 
-static void set_displaymarks(
-		const struct core_dc *dc, struct validate_context *context)
-{
-	/* Do nothing until we have proper bandwitdth calcs */
-}
-
 /**************************************************************************/
 
 bool dce100_hw_sequencer_construct(struct core_dc *dc)
diff --git a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
index 74c7eea..4a51513 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce100/dce100_resource.c
@@ -30,7 +30,6 @@
 
 #include "resource.h"
 #include "include/irq_service_interface.h"
-
 #include "../virtual/virtual_stream_encoder.h"
 #include "dce110/dce110_resource.h"
 #include "dce110/dce110_timing_generator.h"
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c
index 44876386..0b666fb 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c
@@ -466,7 +466,7 @@ static void set_dp_phy_pattern_hbr2_compliance(
 	/* TODO: do we still need this, find out at compliance test
 	addr = mmDP_LINK_FRAMING_CNTL + fe_addr_offset;
 
-	value = (ctx, addr);
+	value = dal_read_reg(ctx, addr);
 
 	set_reg_field_value(value, 0xFC,
 			DP_LINK_FRAMING_CNTL, DP_IDLE_BS_INTERVAL);
diff --git a/drivers/gpu/drm/amd/dal/dc/dm_services.h b/drivers/gpu/drm/amd/dal/dc/dm_services.h
index 5347371..f92d754 100644
--- a/drivers/gpu/drm/amd/dal/dc/dm_services.h
+++ b/drivers/gpu/drm/amd/dal/dc/dm_services.h
@@ -148,13 +148,6 @@ bool dm_exec_bios_cmd_table(
 	uint32_t index,
 	void *params);
 
-#ifdef BUILD_DAL_TEST
-uint32_t dm_bios_cmd_table_para_revision(
-struct dc_context *ctx,
-	uint32_t index);
-#endif
-
-#ifndef BUILD_DAL_TEST
 static inline uint32_t dm_bios_cmd_table_para_revision(
 	struct dc_context *ctx,
 	uint32_t index)
@@ -171,11 +164,6 @@ static inline uint32_t dm_bios_cmd_table_para_revision(
 
 	return crev;
 }
-#else
-uint32_t dm_bios_cmd_table_para_revision(
-		struct dc_context *ctx,
-		uint32_t index);
-#endif
 
 /**************************************
  * Power Play (PP) interfaces
diff --git a/drivers/gpu/drm/amd/dal/dc/dm_services_types.h b/drivers/gpu/drm/amd/dal/dc/dm_services_types.h
index 62ff098..fbdecd7 100644
--- a/drivers/gpu/drm/amd/dal/dc/dm_services_types.h
+++ b/drivers/gpu/drm/amd/dal/dc/dm_services_types.h
@@ -55,110 +55,6 @@
 #define dm_min(x, y) min(x, y)
 #define dm_max(x, y) max(x, y)
 
-#elif defined BUILD_DAL_TEST
-
-#include <inttypes.h>
-#include <stdlib.h>
-#include <string.h>
-
-#include <stdio.h>
-
-#include <stdarg.h>
-
-#include "cgs_linux.h"
-
-#define LONG_MAX	((long)(~0UL>>1))
-#define LONG_MIN	(-LONG_MAX - 1)
-#define LLONG_MAX	((long long)(~0ULL>>1))
-#define LLONG_MIN	(-LLONG_MAX - 1)
-#define UINT_MAX	(~0U)
-
-typedef _Bool bool;
-enum { false, true };
-
-#ifndef NULL
-#define NULL ((void *)0)
-#endif
-
-#define LITTLEENDIAN_CPU 1
-
-#include <test_context.h>
-
-#define offsetof(TYPE, MEMBER) ((size_t) &((TYPE *)0)->MEMBER)
-
-#define container_of(ptr, type, member) \
-	((type *)((char *)(ptr) - offsetof(type, member)))
-
-#define dal_test_not_implemented() \
-	printf("[DAL_TEST_NOT_IMPL]:%s\n", __func__)
-
-#define dm_output_to_console(fmt, ...) do { \
-	printf("[DAL_LOG]" fmt, ##__VA_ARGS__); } \
-	while (false)
-
-#define dm_error(fmt, ...) printf("[DAL_ERROR]" fmt, ##__VA_ARGS__)
-
-#define dm_output_to_console(fmt, ...) do { \
-			printf("[DAL_LOG]" fmt, ##__VA_ARGS__); } \
-				while (false)
-
-#define dm_debug(fmt, ...) printf("[DAL_DBG]" fmt, ##__VA_ARGS__)
-
-#define dm_vlog(fmt, args) vprintf(fmt, args)
-
-#define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]))
-
-#define dm_min(x, y) ({\
-	typeof(x) _min1 = (x);\
-	typeof(y) _min2 = (y);\
-	(void) (&_min1 == &_min2);\
-	_min1 < _min2 ? _min1 : _min2; })
-
-#define dm_max(x, y) ({\
-	typeof(x) _max1 = (x);\
-	typeof(y) _max2 = (y);\
-	(void) (&_max1 == &_max2);\
-	_max1 > _max2 ? _max1 : _max2; })
-
-/* division functions */
-
-static inline int64_t div64_s64(int64_t x, int64_t y)
-{
-	return x / y;
-}
-
-static inline uint64_t div64_u64(uint64_t x, uint64_t y)
-{
-	return x / y;
-}
-
-static inline uint64_t div_u64(uint64_t x, uint32_t y)
-{
-	return x / y;
-}
-
-static inline uint64_t div64_u64_rem(uint64_t x, uint64_t y, uint64_t *rem)
-{
-	if (rem)
-		*rem = x % y;
-	return x / y;
-}
-
-static inline uint64_t div_u64_rem(uint64_t x, uint32_t y, uint32_t *rem)
-{
-	if (rem)
-		*rem = x % y;
-	return x / y;
-}
-
-#define cpu_to_le16(do_nothing) do_nothing
-
-#define le16_to_cpu(do_nothing) do_nothing
-
-#define cpu_to_le32(do_nothing) do_nothing
-
-#define le32_to_cpu(do_nothing) do_nothing
-
 #endif
 
 #include "dc_types.h"
diff --git a/drivers/gpu/drm/amd/dal/include/display_clock_interface.h b/drivers/gpu/drm/amd/dal/include/display_clock_interface.h
index 55648ea..8040ed8 100644
--- a/drivers/gpu/drm/amd/dal/include/display_clock_interface.h
+++ b/drivers/gpu/drm/amd/dal/include/display_clock_interface.h
@@ -126,12 +126,6 @@ struct display_clock *dal_display_clock_dce80_create(
 	struct adapter_service *as);
 #endif
 
-#if defined(CONFIG_DRM_AMD_DAL_DCE8_0)
-struct display_clock *dal_display_clock_dce80_create(
-	struct dc_context *ctx,
-	struct adapter_service *as);
-#endif
-
 void dal_display_clock_destroy(struct display_clock **to_destroy);
 bool dal_display_clock_validate(
 	struct display_clock *disp_clk,
diff --git a/drivers/gpu/drm/amd/dal/include/dpcd_defs.h b/drivers/gpu/drm/amd/dal/include/dpcd_defs.h
index 27b7aee..7031097f 100644
--- a/drivers/gpu/drm/amd/dal/include/dpcd_defs.h
+++ b/drivers/gpu/drm/amd/dal/include/dpcd_defs.h
@@ -510,13 +510,6 @@ union dpcd_training_lane {
 	uint8_t raw;
 };
 
-/*Training Lane Set 2 is used to configure downstream DP device's
-post cursor 2 level of Training Pattern 2 or 3*/
-/* The DPCD addresses are 0x10F (TRAINING_LANE0_1_SET2)
-and 0x110 (TRAINING_LANE2_3_SET2)*/
-
-/* EDP related 0x701 */
-
 /* TMDS-converter related */
 union dwnstream_port_caps_byte0 {
 	struct {
diff --git a/drivers/gpu/drm/amd/dal/include/grph_object_id.h b/drivers/gpu/drm/amd/dal/include/grph_object_id.h
index 64b113b..9ad7620 100644
--- a/drivers/gpu/drm/amd/dal/include/grph_object_id.h
+++ b/drivers/gpu/drm/amd/dal/include/grph_object_id.h
@@ -166,14 +166,12 @@ enum connector_id {
 	CONNECTOR_ID_VIRTUAL = 100
 };
 
-
 /* Audio object ids */
 enum audio_id {
 	AUDIO_ID_UNKNOWN = 0,
 	AUDIO_ID_INTERNAL_AZALIA
 };
 
-
 /* Engine object ids */
 enum engine_id {
 	ENGINE_ID_DIGA,
-- 
2.7.4

