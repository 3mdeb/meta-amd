From 3a867bc861a28c67c5d15b635510940707573f9e Mon Sep 17 00:00:00 2001
From: Jammy Zhou <Jammy.Zhou@amd.com>
Date: Tue, 24 Nov 2015 15:56:40 +0800
Subject: [PATCH 0776/1050] drm/amd/powerplay: fix kernel crash on some ASICs

The crash happened for Fiji/Tonga/etc

Change-Id: I98133f6070dd32387ff40c7455527f0fbaae9ff6
Signed-off-by: Jammy Zhou <Jammy.Zhou@amd.com>
Reviewed-by: Rex Zhu <Rex.Zhu@amd.com>
---
 drivers/gpu/drm/amd/powerplay/hwmgr/hardwaremanager.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/powerplay/hwmgr/hardwaremanager.c b/drivers/gpu/drm/amd/powerplay/hwmgr/hardwaremanager.c
index 2e972ef..31b0dc3 100644
--- a/drivers/gpu/drm/amd/powerplay/hwmgr/hardwaremanager.c
+++ b/drivers/gpu/drm/amd/powerplay/hwmgr/hardwaremanager.c
@@ -263,7 +263,7 @@ int phm_store_dal_configuration_data(struct pp_hwmgr *hwmgr,
 
 int phm_set_cpu_power_state(struct pp_hwmgr *hwmgr)
 {
-	if (hwmgr != NULL || hwmgr->hwmgr_func->set_cpu_power_state != NULL)
+	if (hwmgr != NULL && hwmgr->hwmgr_func->set_cpu_power_state != NULL)
 		return hwmgr->hwmgr_func->set_cpu_power_state(hwmgr);
 
 	return 0;
-- 
1.9.1

