From 515b2cd80320fe66ac54017b7aa46948cc02d5fa Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Nicolai=20H=C3=A4hnle?= <Nicolai.Haehnle@amd.com>
Date: Sat, 11 Jun 2016 11:56:47 +0200
Subject: [PATCH 0562/1722] drm/amd/dal: prevent out-of-bounds read of surfaces
 array
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Reported by CONFIG_KASAN=y.

Signed-off-by: Nicolai HÃ¤hnle <Nicolai.Haehnle@amd.com>
Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc_resource.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c b/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
index f65d6c3..a305ace 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc_resource.c
@@ -529,7 +529,7 @@ bool resource_attach_surfaces_to_context(
 			if (context->res_ctx.pipe_ctx[j].top_pipe != NULL)
 				continue;
 
-			if (surface_count)
+			if (k < surface_count)
 				surface = DC_SURFACE_TO_CORE(surfaces[k]);
 
 			if (context->res_ctx.pipe_ctx[j].stream !=
-- 
2.7.4

