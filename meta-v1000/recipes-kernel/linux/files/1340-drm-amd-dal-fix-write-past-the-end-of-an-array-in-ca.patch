From 93b8c41aa0719ead402a607883707fd5a004efc4 Mon Sep 17 00:00:00 2001
From: Alex Deucher <alexander.deucher@amd.com>
Date: Fri, 14 Oct 2016 15:46:59 -0400
Subject: [PATCH 1340/1722] drm/amd/dal: fix write past the end of an array in
 calculate_bandwidth

Change-Id: Ifa99cbe83ab5a454f396197a6cbf21f49fab229a
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/calcs/bandwidth_calcs.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/calcs/bandwidth_calcs.c b/drivers/gpu/drm/amd/dal/dc/calcs/bandwidth_calcs.c
index 915ee89..b2066f2 100644
--- a/drivers/gpu/drm/amd/dal/dc/calcs/bandwidth_calcs.c
+++ b/drivers/gpu/drm/amd/dal/dc/calcs/bandwidth_calcs.c
@@ -1317,12 +1317,12 @@ static void calculate_bandwidth(
 	/*initialize variables*/
 	number_of_displays_enabled = 0;
 	number_of_displays_enabled_with_margin = 0;
-	for (k = 0; k <= maximum_number_of_surfaces - 1; k++) {
+	for (k = 0; k < maximum_number_of_surfaces; k++) {
 		if (data->enable[k]) {
 			number_of_displays_enabled = number_of_displays_enabled + 1;
 		}
 	}
-	data->display_pstate_change_enable[k] = 0;
+	data->display_pstate_change_enable[maximum_number_of_surfaces - 1] = 0;
 	for (i = 0; i <= 2; i++) {
 		for (j = 0; j <= 7; j++) {
 			data->min_dram_speed_change_margin[i][j] = bw_int_to_fixed(9999);
-- 
2.7.4

