From 072c784d70da7f2091fd4a6240517fd07df01f31 Mon Sep 17 00:00:00 2001
From: Yongqiang Sun <yongqiang.sun@amd.com>
Date: Tue, 5 Jul 2016 17:28:02 -0400
Subject: [PATCH 0602/1722] drm/amd/dal: enable border line for surface debug

Signed-off-by: Yongqiang Sun <yongqiang.sun@amd.com>

Change-Id: Ie35291a9ffc52867675a9ac7191a5910ca128c0b
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc.c                          | 5 +++++
 drivers/gpu/drm/amd/dal/dc/dc.h                               | 5 +++++
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator.c   | 8 ++++++++
 drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator_v.c | 8 ++++++++
 4 files changed, 26 insertions(+)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc.c b/drivers/gpu/drm/amd/dal/dc/core/dc.c
index 36c3c16..072a685 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc.c
@@ -916,6 +916,11 @@ bool dc_commit_surfaces_to_target(
 
 			resource_build_scaling_params(
 				new_surfaces[i], &context->res_ctx.pipe_ctx[j]);
+
+                        if (dc->debug.surface_visual_confirm) {
+                                context->res_ctx.pipe_ctx[j].scl_data.recout.height -= 2;
+                                context->res_ctx.pipe_ctx[j].scl_data.recout.width -= 2;
+                        }
 		}
 
 	if (core_dc->res_pool.funcs->validate_bandwidth(core_dc, context) != DC_OK) {
diff --git a/drivers/gpu/drm/amd/dal/dc/dc.h b/drivers/gpu/drm/amd/dal/dc/dc.h
index 767fd2c..5fd028c 100644
--- a/drivers/gpu/drm/amd/dal/dc/dc.h
+++ b/drivers/gpu/drm/amd/dal/dc/dc.h
@@ -62,10 +62,15 @@ struct dc_config {
 	bool gpu_vm_support;
 };
 
+struct dc_debug {
+	bool surface_visual_confirm;
+};
+
 struct dc {
 	struct dc_caps caps;
 	struct dc_stream_funcs stream_funcs;
 	struct dc_config config;
+	struct dc_debug debug;
 };
 
 struct dc_init_data {
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator.c
index bb12a57..9bab93e 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator.c
@@ -31,6 +31,7 @@
 
 #include "dc_types.h"
 #include "dc_bios_types.h"
+#include "dc.h"
 
 #include "include/grph_object_id.h"
 #include "include/adapter_service_interface.h"
@@ -1634,6 +1635,13 @@ void dce110_timing_generator_set_overscan_color_black(
 
 	default:
 		/* default is sRGB black 0. */
+		if (tg->ctx->dc->debug.surface_visual_confirm) {
+			set_reg_field_value(
+				value,
+				0x3ff,
+				CRTC_OVERSCAN_COLOR,
+				CRTC_OVERSCAN_COLOR_RED);
+		}
 		break;
 	}
 	addr = CRTC_REG(mmCRTC_OVERSCAN_COLOR);
diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator_v.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator_v.c
index ad7ceb4..e6a9288 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator_v.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_timing_generator_v.c
@@ -6,6 +6,7 @@
 
 #include "dc_types.h"
 #include "dc_bios_types.h"
+#include "dc.h"
 
 #include "include/grph_object_id.h"
 #include "include/adapter_service_interface.h"
@@ -559,6 +560,13 @@ static void dce110_timing_generator_v_set_overscan_color_black(
 
 	default:
 		/* default is sRGB black 0. */
+		if (tg->ctx->dc->debug.surface_visual_confirm) {
+			set_reg_field_value(
+				value,
+				0x3ff,
+				CRTCV_OVERSCAN_COLOR,
+				CRTC_OVERSCAN_COLOR_GREEN);
+		}
 		break;
 	}
 	addr = mmCRTCV_OVERSCAN_COLOR;
-- 
2.7.4

