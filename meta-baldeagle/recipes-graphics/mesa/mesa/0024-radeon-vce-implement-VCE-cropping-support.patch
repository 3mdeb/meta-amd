From 9e4832122ec4c20302a789103e8a6b86eb1f6c44 Mon Sep 17 00:00:00 2001
From: Leo Liu <leo.liu@amd.com>
Date: Mon, 3 Feb 2014 15:13:14 -0500
Subject: [PATCH 24/27] radeon/vce: implement VCE cropping support

Signed-off-by: Leo Liu <leo.liu@amd.com>
---
 src/gallium/drivers/radeon/radeon_vce_v1_0.c |    4 ++--
 src/gallium/drivers/radeon/radeon_vce_v2_0.c |    4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/gallium/drivers/radeon/radeon_vce_v1_0.c b/src/gallium/drivers/radeon/radeon_vce_v1_0.c
index 581d713..1e7d93b 100644
--- a/src/gallium/drivers/radeon/radeon_vce_v1_0.c
+++ b/src/gallium/drivers/radeon/radeon_vce_v1_0.c
@@ -178,9 +178,9 @@ static void pic_control(struct rvce_encoder *enc)
 	RVCE_CS(0x00000000); // encIPicPeriod
 	RVCE_CS(0x00000000); // encHeaderInsertionSpacing
 	RVCE_CS(0x00000000); // encCropLeftOffset
-	RVCE_CS(0x00000000); // encCropRightOffset
+	RVCE_CS((align(enc->base.width, 16) - enc->base.width) >> 1); // encCropRightOffset
 	RVCE_CS(0x00000000); // encCropTopOffset
-	RVCE_CS(0x00000000); // encCropBottomOffset
+	RVCE_CS((align(enc->base.height, 16) - enc->base.height) >> 1); // encCropBottomOffset
 	RVCE_CS(encNumMBsPerSlice); // encNumMBsPerSlice
 	RVCE_CS(0x00000000); // encIntraRefreshNumMBsPerSlot
 	RVCE_CS(0x00000000); // encForceIntraRefresh
diff --git a/src/gallium/drivers/radeon/radeon_vce_v2_0.c b/src/gallium/drivers/radeon/radeon_vce_v2_0.c
index 7b549bb..0fe2291 100644
--- a/src/gallium/drivers/radeon/radeon_vce_v2_0.c
+++ b/src/gallium/drivers/radeon/radeon_vce_v2_0.c
@@ -137,9 +137,9 @@ static void pic_control(struct rvce_encoder *enc)
 	RVCE_CS(0x00000000); // encLFBetaOffset
 	RVCE_CS(0x00000000); // encLFAlphaC0Offset
 	RVCE_CS(0x00000000); // encCropLeftOffset
-	RVCE_CS(0x00000000); // encCropRightOffset
+	RVCE_CS((align(enc->base.width, 16) - enc->base.width) >> 1); // encCropRightOffset
 	RVCE_CS(0x00000000); // encCropTopOffset
-	RVCE_CS(0x00000000); // encCropBottomOffset
+	RVCE_CS((align(enc->base.height, 16) - enc->base.height) >> 1); // encCropBottomOffset
 	RVCE_CS(encNumMBsPerSlice); // encNumMBsPerSlice
 	RVCE_CS(0x00000000); // encIntraRefreshNumMBsPerSlot
 	RVCE_CS(0x00000000); // encForceIntraRefresh
-- 
1.7.9.5

