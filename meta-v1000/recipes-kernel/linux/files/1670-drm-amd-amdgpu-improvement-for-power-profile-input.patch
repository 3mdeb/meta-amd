From bd60d915c73ce99c98b62f784577757c2e484c3c Mon Sep 17 00:00:00 2001
From: Eric Huang <JinHuiEric.Huang@amd.com>
Date: Tue, 4 Oct 2016 14:39:41 -0400
Subject: [PATCH 1670/1722] drm/amd/amdgpu: improvement for power profile input

Change-Id: Ib48c67c710210cbb3b4b650085fb13903d18239a
Signed-off-by: Eric Huang <JinHuiEric.Huang@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
index 3cb4213..68cdde5 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_pm.c
@@ -650,10 +650,15 @@ static ssize_t amdgpu_set_pp_power_profile(struct device *dev,
 		return count;
 	}
 
+	if (count >= 128) {
+		count = -EINVAL;
+		goto fail;
+	}
+
 	memcpy(buf_cpy, buf, count);
 	tmp_str = buf_cpy;
 
-	while (strlen(tmp_str)) {
+	while (tmp_str[0]) {
 		sub_str = strsep(&tmp_str, delimiter);
 		ret = kstrtol(sub_str, 0, &value);
 		if (ret) {
-- 
2.7.4

