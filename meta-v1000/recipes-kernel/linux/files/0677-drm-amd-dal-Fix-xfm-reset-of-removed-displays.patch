From f1f873968b9c6c7b85d8416cfe9f6ae778bdd819 Mon Sep 17 00:00:00 2001
From: Jordan Lazare <Jordan.Lazare@amd.com>
Date: Tue, 2 Aug 2016 18:58:53 -0400
Subject: [PATCH 0677/1722] drm/amd/dal: Fix xfm reset of removed displays

Before this change there was a potential null pointer segfault

Signed-off-by: Jordan Lazare <Jordan.Lazare@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/core/dc.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/dc/core/dc.c b/drivers/gpu/drm/amd/dal/dc/core/dc.c
index 1884a79..879409b 100644
--- a/drivers/gpu/drm/amd/dal/dc/core/dc.c
+++ b/drivers/gpu/drm/amd/dal/dc/core/dc.c
@@ -1050,8 +1050,8 @@ bool dc_post_commit_surfaces_to_target(
                         core_dc->hwss.enable_display_power_gating(
                                 core_dc->ctx, i, core_dc->ctx->dc_bios,
                                 PIPE_GATING_CONTROL_ENABLE);
-                        context->res_ctx.pipe_ctx[i].xfm->funcs->transform_reset(
-                                        context->res_ctx.pipe_ctx[i].xfm);
+                        core_dc->current_context->res_ctx.pipe_ctx[i].xfm->funcs->transform_reset(
+                                        core_dc->current_context->res_ctx.pipe_ctx[i].xfm);
                         memset(&context->res_ctx.pipe_ctx[i], 0, sizeof(struct pipe_ctx));
                 }
         }
-- 
2.7.4

