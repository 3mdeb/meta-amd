From d9387efbad7a2ce8b65ac1b2e7211debd2d0a8e4 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Date: Sun, 9 Feb 2014 08:36:40 -0700
Subject: [PATCH 27/27] st/omx/enc: always flush the transfer pipe before
 encoding
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Christian KÃ¶nig <christian.koenig@amd.com>
---
 src/gallium/state_trackers/omx/vid_enc.c |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/gallium/state_trackers/omx/vid_enc.c b/src/gallium/state_trackers/omx/vid_enc.c
index 53a8ef9..2770379 100644
--- a/src/gallium/state_trackers/omx/vid_enc.c
+++ b/src/gallium/state_trackers/omx/vid_enc.c
@@ -746,11 +746,12 @@ static OMX_ERRORTYPE vid_enc_EncodeFrame(omx_base_PortType *port, OMX_BUFFERHEAD
          vl_compositor_set_rgba_layer(s, compositor, 0, views[i], &src_rect[i], NULL, NULL);
          vl_compositor_render(s, compositor, dst_surface[i], NULL, false);
       }
-      priv->s_pipe->flush(priv->s_pipe, NULL, 0);
       
       size  = priv->scale.xWidth * priv->scale.xHeight * 2; 
       vbuf = priv->scale_buffer; 
-   } 
+   }
+
+   priv->s_pipe->flush(priv->s_pipe, NULL, 0);
 
    /* -------------- allocate output buffer --------- */
 
-- 
1.7.9.5

