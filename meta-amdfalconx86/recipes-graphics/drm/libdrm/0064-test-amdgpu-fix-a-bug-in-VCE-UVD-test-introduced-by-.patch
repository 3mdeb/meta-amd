From 2caeaabdd47ff5a32d0ce9bea53a4b9f8ac800f6 Mon Sep 17 00:00:00 2001
From: Ken Wang <Qingqing.Wang@amd.com>
Date: Fri, 17 Jul 2015 19:39:56 +0800
Subject: [PATCH 64/67] test/amdgpu : fix a bug in VCE/UVD test introduced by
 previous change

Signed-off-by: Ken Wang <Qingqing.Wang@amd.com>
Reviewed-by: Jammy Zhou <Jammy.Zhou@amd.com>
Signed-off-by: Arindam Nath <arindam.nath@amd.com>
---
 tests/amdgpu/cs_tests.c  | 2 ++
 tests/amdgpu/vce_tests.c | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/tests/amdgpu/cs_tests.c b/tests/amdgpu/cs_tests.c
index 4d02df2..faceb83 100644
--- a/tests/amdgpu/cs_tests.c
+++ b/tests/amdgpu/cs_tests.c
@@ -134,6 +134,7 @@ static int submit(unsigned ndw, unsigned ip)
 
 	ibs_request.number_of_ibs = 1;
 	ibs_request.ibs = &ib_info;
+	ibs_request.fence_info.handle = NULL;
 
 	r = amdgpu_cs_submit(context_handle, 0, &ibs_request, 1);
 	if (r)
@@ -145,6 +146,7 @@ static int submit(unsigned ndw, unsigned ip)
 
 	fence_status.context = context_handle;
 	fence_status.ip_type = ip;
+	fence_status.fence = ibs_request.seq_no;
 
 	r = amdgpu_cs_query_fence_status(&fence_status,
 					 AMDGPU_TIMEOUT_INFINITE,
diff --git a/tests/amdgpu/vce_tests.c b/tests/amdgpu/vce_tests.c
index bc88725..b549392 100644
--- a/tests/amdgpu/vce_tests.c
+++ b/tests/amdgpu/vce_tests.c
@@ -150,6 +150,7 @@ static int submit(unsigned ndw, unsigned ip)
 
 	ibs_request.number_of_ibs = 1;
 	ibs_request.ibs = &ib_info;
+	ibs_request.fence_info.handle = NULL;
 
 	r = amdgpu_cs_submit(context_handle, 0, &ibs_request, 1);
 	if (r)
@@ -161,6 +162,7 @@ static int submit(unsigned ndw, unsigned ip)
 
 	fence_status.context = context_handle;
 	fence_status.ip_type = ip;
+	fence_status.fence = ibs_request.seq_no;
 
 	r = amdgpu_cs_query_fence_status(&fence_status,
 					 AMDGPU_TIMEOUT_INFINITE,
-- 
1.9.1

