From d8f718bdba859419ebe36e1eddbd05d437431c3f Mon Sep 17 00:00:00 2001
From: David Rokhvarg <David.Rokhvarg@amd.com>
Date: Thu, 3 Sep 2015 12:01:00 -0400
Subject: [PATCH 06/14] amd/dal: Fixed Cursor programming sequence.

Signed-off-by: David Rokhvarg <David.Rokhvarg@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
Reviewed-by: Eagle Yeh <Eagle.Yeh@amd.com>
---
 drivers/gpu/drm/amd/dal/controller/dce110/cursor_dce110.c | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/controller/dce110/cursor_dce110.c b/drivers/gpu/drm/amd/dal/controller/dce110/cursor_dce110.c
index b810963..0473ce7 100644
--- a/drivers/gpu/drm/amd/dal/controller/dce110/cursor_dce110.c
+++ b/drivers/gpu/drm/amd/dal/controller/dce110/cursor_dce110.c
@@ -178,10 +178,16 @@ static void program_address(
 	struct cursor *cur,
 	PHYSICAL_ADDRESS_LOC address)
 {
-	dal_write_reg(cur->ctx, cur->regs[IDX_CUR_SURFACE_ADDRESS],
-			address.low_part);
+	/* SURFACE_ADDRESS_HIGH: Higher order bits (39:32) of hardware cursor
+	 * surface base address in byte. It is 4K byte aligned.
+	 * The correct way to program cursor surface address is to first write
+	 * to CUR_SURFACE_ADDRESS_HIGH, and then write to CUR_SURFACE_ADDRESS */
+
 	dal_write_reg(cur->ctx, cur->regs[IDX_CUR_SURFACE_ADDRESS_HIGH],
 			address.high_part);
+
+	dal_write_reg(cur->ctx, cur->regs[IDX_CUR_SURFACE_ADDRESS],
+			address.low_part);
 }
 
 
-- 
2.1.4

