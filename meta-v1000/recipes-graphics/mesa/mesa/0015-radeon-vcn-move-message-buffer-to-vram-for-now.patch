From e8f1bc2b5c7ed602e549e5e78935db302b6c648f Mon Sep 17 00:00:00 2001
From: Leo Liu <leo.liu@amd.com>
Date: Tue, 18 Jul 2017 09:48:02 -0400
Subject: [PATCH] radeon/vcn: move message buffer to vram for now
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

To workaround an unknown bug.

Signed-off-by: Leo Liu <leo.liu@amd.com>
Acked-by: Christian KÃ¶nig <christian.koenig@amd.com>
---
 src/gallium/drivers/radeon/radeon_vcn_dec.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/gallium/drivers/radeon/radeon_vcn_dec.c b/src/gallium/drivers/radeon/radeon_vcn_dec.c
index 82dfa71..33d49f5 100644
--- a/src/gallium/drivers/radeon/radeon_vcn_dec.c
+++ b/src/gallium/drivers/radeon/radeon_vcn_dec.c
@@ -1236,8 +1236,9 @@ struct pipe_video_codec *radeon_create_decoder(struct pipe_context *context,
 		unsigned msg_fb_it_size = FB_BUFFER_OFFSET + FB_BUFFER_SIZE;
 		if (have_it(dec))
 			msg_fb_it_size += IT_SCALING_TABLE_SIZE;
+		/* use vram to improve performance, workaround an unknown bug */
 		if (!rvid_create_buffer(dec->screen, &dec->msg_fb_it_buffers[i],
-					msg_fb_it_size, PIPE_USAGE_STAGING)) {
+					msg_fb_it_size, PIPE_USAGE_DEFAULT)) {
 			RVID_ERR("Can't allocated message buffers.\n");
 			goto error;
 		}
-- 
2.7.4

