From 8fea9b2202ee430ccdb4c689aeef16fdc7fac667 Mon Sep 17 00:00:00 2001
From: Harry Wentland <harry.wentland@amd.com>
Date: Fri, 19 Aug 2016 09:36:58 -0400
Subject: [PATCH 0829/1722] drm/amd/dal: Notify freesync of mode change in
 dm_restore_drm_connector_state

Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_types.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_types.c b/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_types.c
index 23c74e8..b928076 100644
--- a/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_types.c
+++ b/drivers/gpu/drm/amd/dal/amdgpu_dm/amdgpu_dm_types.c
@@ -2752,9 +2752,16 @@ void dm_restore_drm_connector_state(struct drm_device *dev, struct drm_connector
 		list_for_each_entry(crtc, &dev->mode_config.crtc_list, head) {
 			struct amdgpu_crtc *acrtc = to_amdgpu_crtc(crtc);
 
-			if (acrtc->target != NULL)
+			if (acrtc->target != NULL) {
 				acrtc->otg_inst =
 					dc_target_get_status(acrtc->target)->primary_otg_inst;
+
+				if (adev->dm.freesync_module)
+					mod_freesync_notify_mode_change(
+							adev->dm.freesync_module,
+							acrtc->target->streams,
+							acrtc->target->stream_count);
+			}
 		}
 
 		dc_target_release(current_target);
-- 
2.7.4

