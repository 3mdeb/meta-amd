From 0b3281af91743b19cc722288afe85938027b5e74 Mon Sep 17 00:00:00 2001
From: Mykola Lysenko <mykola.lysenko@amd.com>
Date: Thu, 9 Jul 2015 07:42:35 -0400
Subject: [PATCH 355/401] drm/amd/amdgpu: [DSAT] Fixed warnings

Signed-off-by: Mykola Lysenko <mykola.lysenko@amd.com>

Reviewed-by: Eagle Yeh <eagle.yeh@amd.com>
Signed-off-by: Sanjay R Mehta <sanju.mehta@amd.com>
---
 drivers/gpu/drm/amd/dsat/amdgpu_dsat_ioctl.c | 21 +++++++++++----------
 drivers/gpu/drm/amd/dsat/dsat.c              |  1 -
 2 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/drivers/gpu/drm/amd/dsat/amdgpu_dsat_ioctl.c b/drivers/gpu/drm/amd/dsat/amdgpu_dsat_ioctl.c
index 8f58996..b438814 100644
--- a/drivers/gpu/drm/amd/dsat/amdgpu_dsat_ioctl.c
+++ b/drivers/gpu/drm/amd/dsat/amdgpu_dsat_ioctl.c
@@ -36,15 +36,11 @@
 int amdgpu_dsat_cmd_ioctl(struct drm_device *dev, void *data,
 		struct drm_file *filp)
 {
-	if (amdgpu_dal == 0)
-		return -EINVAL;
-
 	struct amdgpu_device *rdev;
 	struct amdgpu_display_manager *dm;
 	struct dal *dal;
 	struct drm_amdgpu_dsat_cmd_context *dsat_ctx = data;
 
-	int i;
 	uint32_t ret = 0;
 
 	uint64_t user_input_ptr = dsat_ctx->in_ptr;
@@ -54,6 +50,9 @@ int amdgpu_dsat_cmd_ioctl(struct drm_device *dev, void *data,
 	struct amdgpu_dsat_input_context *kernel_in_data = NULL;
 	struct amdgpu_dsat_output_context *kernel_out_data = NULL;
 
+	if (amdgpu_dal == 0)
+		return -EINVAL;
+
 	rdev = (struct amdgpu_device *) dev->dev_private;
 	dm = &rdev->dm;
 	dal = dm->dal;
@@ -315,6 +314,9 @@ int amdgpu_dsat_cmd_ioctl(struct drm_device *dev, void *data,
 		break;
 	}
 	case DSAT_CMD_READ_HW_REG: {
+		struct dsat_hw_rw_request *request;
+		uint32_t *reg_value;
+
 		if (kernel_in_data->in_data_size <
 				sizeof(struct dsat_hw_rw_request)) {
 			dsat_ctx->ret = DSAT_CMD_DATA_ERROR;
@@ -325,10 +327,8 @@ int amdgpu_dsat_cmd_ioctl(struct drm_device *dev, void *data,
 			break;
 		}
 
-
-		struct dsat_hw_rw_request *request =
-			(struct dsat_hw_rw_request *) kernel_in_data->data;
-		uint32_t *reg_value = (uint32_t *) kernel_out_data->data;
+		request = (struct dsat_hw_rw_request *) kernel_in_data->data;
+		reg_value = (uint32_t *) kernel_out_data->data;
 
 		kernel_out_data->data_size = sizeof(uint32_t);
 		*reg_value = dsat_read_hw_reg(dm, request->address);
@@ -336,14 +336,15 @@ int amdgpu_dsat_cmd_ioctl(struct drm_device *dev, void *data,
 		break;
 	}
 	case DSAT_CMD_WRITE_HW_REG: {
+		struct dsat_hw_rw_request *request;
+
 		if (kernel_in_data->in_data_size <
 				sizeof(struct dsat_hw_rw_request)) {
 			dsat_ctx->ret = DSAT_CMD_DATA_ERROR;
 			break;
 		}
 
-		struct dsat_hw_rw_request *request =
-			(struct dsat_hw_rw_request *) kernel_in_data->data;
+		request = (struct dsat_hw_rw_request *) kernel_in_data->data;
 
 		dsat_write_hw_reg(dm, request->address, request->value);
 
diff --git a/drivers/gpu/drm/amd/dsat/dsat.c b/drivers/gpu/drm/amd/dsat/dsat.c
index 5d8cd2c..26e11e4 100644
--- a/drivers/gpu/drm/amd/dsat/dsat.c
+++ b/drivers/gpu/drm/amd/dsat/dsat.c
@@ -811,7 +811,6 @@ bool dsat_display_mode_timing_get_list(
 	uint32_t mt_nums = 0;
 	uint32_t idx = 0;
 	struct dal_timing_list_query *tlsq;
-	struct mode_timing *mt_dst = mode_timing;
 	bool ret_val = false;
 
 	amdgpu_dm_acquire_dal_lock(dm);
-- 
1.9.1

