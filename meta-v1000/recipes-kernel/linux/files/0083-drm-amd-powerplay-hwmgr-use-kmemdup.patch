From de70e78ffb7bfac85714b6934254e3c94b43aacb Mon Sep 17 00:00:00 2001
From: Muhammad Falak R Wani <falakreyaz@gmail.com>
Date: Thu, 19 May 2016 16:45:29 +0530
Subject: [PATCH 0083/1722] drm/amd/powerplay/hwmgr: use kmemdup

Use kmemdup when some other buffer is immediately copied into allocated
region. It replaces call to allocation followed by memcpy, by a single
call to kmemdup.

Signed-off-by: Muhammad Falak R Wani <falakreyaz@gmail.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/powerplay/hwmgr/tonga_hwmgr.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/amd/powerplay/hwmgr/tonga_hwmgr.c b/drivers/gpu/drm/amd/powerplay/hwmgr/tonga_hwmgr.c
index fdf6b9b..fa05a7c 100644
--- a/drivers/gpu/drm/amd/powerplay/hwmgr/tonga_hwmgr.c
+++ b/drivers/gpu/drm/amd/powerplay/hwmgr/tonga_hwmgr.c
@@ -6054,7 +6054,15 @@ static int tonga_get_fan_control_mode(struct pp_hwmgr *hwmgr)
 +static int tonga_get_pp_table(struct pp_hwmgr *hwmgr, char **table)
 {
         struct tonga_hwmgr *data = (struct tonga_hwmgr *)(hwmgr->backend);
- 
+	
+	if (!data->soft_pp_table) { 
+                data->soft_pp_table = kmemdup(hwmgr->soft_pp_table,
+                                              hwmgr->soft_pp_table_size,
+                                              GFP_KERNEL);
+		if (!data->soft_pp_table)
+                        return -ENOMEM;
+	}
+
         *table = (char *)&data->smc_state_table;
  
         return sizeof(struct SMU72_Discrete_DpmTable);
-- 
2.7.4

