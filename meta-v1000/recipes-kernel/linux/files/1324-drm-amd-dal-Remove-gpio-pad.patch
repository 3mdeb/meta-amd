From f341fbc8dfcc438c24923532299c2e1015a409af Mon Sep 17 00:00:00 2001
From: Harry Wentland <harry.wentland@amd.com>
Date: Wed, 12 Oct 2016 21:45:45 -0400
Subject: [PATCH 1324/1722] drm/amd/dal: Remove gpio pad

Change-Id: I9e94d240737c5e48a0aac1c35e0566782b4df85d
Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
---
 drivers/gpu/drm/amd/dal/dc/gpio/Makefile           |  2 +-
 .../drm/amd/dal/dc/gpio/dce110/hw_factory_dce110.c |  1 -
 .../drm/amd/dal/dc/gpio/dce80/hw_factory_dce80.c   |  2 -
 .../amd/dal/dc/gpio/diagnostics/hw_factory_diag.c  |  1 -
 drivers/gpu/drm/amd/dal/dc/gpio/gpio_service.c     |  4 -
 drivers/gpu/drm/amd/dal/dc/gpio/hw_factory.h       |  4 -
 drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.c      | 91 ----------------------
 drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.h      | 47 -----------
 8 files changed, 1 insertion(+), 151 deletions(-)
 delete mode 100644 drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.c
 delete mode 100644 drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.h

diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/Makefile b/drivers/gpu/drm/amd/dal/dc/gpio/Makefile
index 61a69d1..284fdf3 100644
--- a/drivers/gpu/drm/amd/dal/dc/gpio/Makefile
+++ b/drivers/gpu/drm/amd/dal/dc/gpio/Makefile
@@ -3,7 +3,7 @@
 # It provides the control and status of HW GPIO pins.
 
 GPIO = gpio_base.o gpio_service.o hw_ddc.o hw_factory.o \
-       hw_gpio.o hw_gpio_pad.o hw_hpd.o hw_translate.o
+       hw_gpio.o hw_hpd.o hw_translate.o
 
 AMD_DAL_GPIO = $(addprefix $(AMDDALPATH)/dc/gpio/,$(GPIO))
 
diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/dce110/hw_factory_dce110.c b/drivers/gpu/drm/amd/dal/dc/gpio/dce110/hw_factory_dce110.c
index 88714ca..af807c0 100644
--- a/drivers/gpu/drm/amd/dal/dc/gpio/dce110/hw_factory_dce110.c
+++ b/drivers/gpu/drm/amd/dal/dc/gpio/dce110/hw_factory_dce110.c
@@ -50,7 +50,6 @@ static const struct hw_factory_funcs funcs = {
 	.create_ddc_clock = dal_hw_ddc_dce110_create,
 	.create_generic = NULL,
 	.create_hpd = dal_hw_hpd_dce110_create,
-	.create_gpio_pad = NULL,
 	.create_sync = NULL,
 	.create_gsl = NULL,
 };
diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/dce80/hw_factory_dce80.c b/drivers/gpu/drm/amd/dal/dc/gpio/dce80/hw_factory_dce80.c
index d139c77..0d64a80 100644
--- a/drivers/gpu/drm/amd/dal/dc/gpio/dce80/hw_factory_dce80.c
+++ b/drivers/gpu/drm/amd/dal/dc/gpio/dce80/hw_factory_dce80.c
@@ -42,7 +42,6 @@
  */
 
 #include "../hw_gpio.h"
-#include "../hw_gpio_pad.h"
 #include "../hw_ddc.h"
 #include "hw_ddc_dce80.h"
 #include "../hw_hpd.h"
@@ -56,7 +55,6 @@ static const struct hw_factory_funcs funcs = {
 	.create_ddc_clock = dal_hw_ddc_dce80_create,
 	.create_generic = NULL,
 	.create_hpd = dal_hw_hpd_dce80_create,
-	.create_gpio_pad = NULL,
 	.create_sync = NULL,
 	.create_gsl = NULL,
 };
diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/diagnostics/hw_factory_diag.c b/drivers/gpu/drm/amd/dal/dc/gpio/diagnostics/hw_factory_diag.c
index 6a7b5f5..26695b9 100644
--- a/drivers/gpu/drm/amd/dal/dc/gpio/diagnostics/hw_factory_diag.c
+++ b/drivers/gpu/drm/amd/dal/dc/gpio/diagnostics/hw_factory_diag.c
@@ -45,7 +45,6 @@ static const struct hw_factory_funcs funcs = {
 	.create_ddc_clock = NULL,
 	.create_generic = NULL,
 	.create_hpd = NULL,
-	.create_gpio_pad = NULL,
 	.create_sync = NULL,
 	.create_gsl = NULL,
 };
diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/gpio_service.c b/drivers/gpu/drm/amd/dal/dc/gpio/gpio_service.c
index 26007a9..fbd788d 100644
--- a/drivers/gpu/drm/amd/dal/dc/gpio/gpio_service.c
+++ b/drivers/gpu/drm/amd/dal/dc/gpio/gpio_service.c
@@ -264,10 +264,6 @@ enum gpio_result dal_gpio_service_open(
 		pin = service->factory.funcs->create_hpd(
 			service->ctx, id, en);
 	break;
-	case GPIO_ID_GPIO_PAD:
-		pin = service->factory.funcs->create_gpio_pad(
-			service->ctx, id, en);
-	break;
 	case GPIO_ID_SYNC:
 		pin = service->factory.funcs->create_sync(
 			service->ctx, id, en);
diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/hw_factory.h b/drivers/gpu/drm/amd/dal/dc/gpio/hw_factory.h
index 1fa8b6d..9845fba 100644
--- a/drivers/gpu/drm/amd/dal/dc/gpio/hw_factory.h
+++ b/drivers/gpu/drm/amd/dal/dc/gpio/hw_factory.h
@@ -48,10 +48,6 @@ struct hw_factory {
 			struct dc_context *ctx,
 			enum gpio_id id,
 			uint32_t en);
-		struct hw_gpio_pin *(*create_gpio_pad)(
-			struct dc_context *ctx,
-			enum gpio_id id,
-			uint32_t en);
 		struct hw_gpio_pin *(*create_sync)(
 			struct dc_context *ctx,
 			enum gpio_id id,
diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.c b/drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.c
deleted file mode 100644
index cb47353..0000000
--- a/drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.c
+++ /dev/null
@@ -1,91 +0,0 @@
-/*
- * Copyright 2012-15 Advanced Micro Devices, Inc.
- *
- * Permission is hereby granted, free of charge, to any person obtaining a
- * copy of this software and associated documentation files (the "Software"),
- * to deal in the Software without restriction, including without limitation
- * the rights to use, copy, modify, merge, publish, distribute, sublicense,
- * and/or sell copies of the Software, and to permit persons to whom the
- * Software is furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
- * THE COPYRIGHT HOLDER(S) OR AUTHOR(S) BE LIABLE FOR ANY CLAIM, DAMAGES OR
- * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
- * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
- * OTHER DEALINGS IN THE SOFTWARE.
- *
- * Authors: AMD
- *
- */
-
-#include "dm_services.h"
-
-/*
- * Pre-requisites: headers required by header of this unit
- */
-#include "include/gpio_types.h"
-#include "hw_gpio.h"
-
-/*
- * Header of this unit
- */
-
-#include "hw_gpio_pad.h"
-
-/*
- * Post-requisites: headers required by this unit
- */
-
-/*
- * This unit
- */
-
-#define FROM_HW_GPIO(ptr) \
-	container_of((ptr), struct hw_gpio_pad, base)
-
-#define FROM_HW_GPIO_PIN(ptr) \
-	FROM_HW_GPIO(container_of((ptr), struct hw_gpio, base))
-
-enum gpio_result dal_hw_gpio_pad_get_value(
-	const struct hw_gpio_pin *ptr,
-	uint32_t *value)
-{
-	const struct hw_gpio_pad *pin = FROM_HW_GPIO_PIN(ptr);
-
-	if (ptr->mode == GPIO_MODE_INTERRUPT)
-		/* in Interrupt mode, ask for interrupt status bit */
-		return dal_hw_gpio_get_reg_value(
-			ptr->ctx,
-			&pin->gpiopad_int_status,
-			value);
-	else
-		/* for any mode other than Interrupt,
-		 * gpio_pad operates as normal GPIO */
-		return dal_hw_gpio_get_value(ptr, value);
-}
-
-bool dal_hw_gpio_pad_construct(
-	struct hw_gpio_pad *pin,
-	enum gpio_id id,
-	uint32_t en,
-	struct dc_context *ctx)
-{
-	if (!dal_hw_gpio_construct(&pin->base, id, en, ctx))
-		return false;
-
-	pin->gpiopad_int_status.addr = 0;
-	pin->gpiopad_int_status.mask = 0;
-
-	return true;
-}
-
-void dal_hw_gpio_pad_destruct(
-	struct hw_gpio_pad *pin)
-{
-	dal_hw_gpio_destruct(&pin->base);
-}
diff --git a/drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.h b/drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.h
deleted file mode 100644
index 34b470a..0000000
--- a/drivers/gpu/drm/amd/dal/dc/gpio/hw_gpio_pad.h
+++ /dev/null
@@ -1,47 +0,0 @@
-/*
- * Copyright 2012-15 Advanced Micro Devices, Inc.
- *
- * Permission is hereby granted, free of charge, to any person obtaining a
- * copy of this software and associated documentation files (the "Software"),
- * to deal in the Software without restriction, including without limitation
- * the rights to use, copy, modify, merge, publish, distribute, sublicense,
- * and/or sell copies of the Software, and to permit persons to whom the
- * Software is furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
- * THE COPYRIGHT HOLDER(S) OR AUTHOR(S) BE LIABLE FOR ANY CLAIM, DAMAGES OR
- * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
- * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
- * OTHER DEALINGS IN THE SOFTWARE.
- *
- * Authors: AMD
- *
- */
-
-#ifndef __DAL_HW_GPIO_PAD_H__
-#define __DAL_HW_GPIO_PAD_H__
-
-struct hw_gpio_pad {
-	struct hw_gpio base;
-	struct addr_mask gpiopad_int_status;
-};
-
-bool dal_hw_gpio_pad_construct(
-	struct hw_gpio_pad *pin,
-	enum gpio_id id,
-	uint32_t en,
-	struct dc_context *ctx);
-
-void dal_hw_gpio_pad_destruct(
-	struct hw_gpio_pad *pin);
-
-enum gpio_result dal_hw_gpio_pad_get_value(
-	const struct hw_gpio_pin *ptr,
-	uint32_t *value);
-
-#endif
-- 
2.7.4

