From c15b0fd450453e4c86c33a44f0300c3d2dfadc2a Mon Sep 17 00:00:00 2001
From: Kent Russell <kent.russell@amd.com>
Date: Fri, 21 Oct 2016 11:52:06 -0400
Subject: [PATCH 1696/1722] drm/amdgpu: Add a wrapper for
 amdgpu_amdkfd_bo_validate

In the 4.7 kernel, the validate function for cs and gem use a specific
format with a pointer to the parameters being passed in, then the bo.
Add a wrapper to match that format to assist in reconciling the code to
the 4.7 branch.

Change-Id: I1f5d257da1562498492fce244614c09249a94169
Signed-off-by: Kent Russell <kent.russell@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c
index 6bc9038..98c217e 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_amdkfd_gpuvm.c
@@ -54,6 +54,12 @@ struct kfd_mem_usage_limit {
 
 static struct kfd_mem_usage_limit kfd_mem_limit;
 
+/* Struct used for amdgpu_amdkfd_bo_validate */
+struct amdgpu_vm_parser {
+	uint32_t        domain;
+	bool            wait;
+};
+
 
 static inline struct amdgpu_device *get_amdgpu_device(struct kgd_dev *kgd)
 {
@@ -273,6 +279,13 @@ validate_fail:
 	return ret;
 }
 
+static int amdgpu_amdkfd_validate(void *param, struct amdgpu_bo *bo)
+{
+	struct amdgpu_vm_parser *p = param;
+
+	return amdgpu_amdkfd_bo_validate(bo, p->domain, p->wait);
+}
+
 static int amdgpu_amdkfd_bo_invalidate(struct amdgpu_bo *bo)
 {
 	int ret = 0;
-- 
2.7.4

