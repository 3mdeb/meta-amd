From 2d7f8b9351b7eb725a688701a241cedf37bb2312 Mon Sep 17 00:00:00 2001
From: Mykola Lysenko <Mykola.Lysenko@amd.com>
Date: Mon, 30 May 2016 16:50:43 +0800
Subject: [PATCH 0510/1722] drm/amd/dal: enable up to 4 MST displays

Handling of 4th stream programming was missed

Signed-off-by: Mykola Lysenko <Mykola.Lysenko@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 .../drm/amd/dal/dc/dce110/dce110_link_encoder.c    | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)

diff --git a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c
index 44d1cb1..7f2370d 100644
--- a/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c
+++ b/drivers/gpu/drm/amd/dal/dc/dce110/dce110_link_encoder.c
@@ -1666,6 +1666,28 @@ void dce110_link_encoder_update_mst_stream_allocation_table(
 		DP_MSE_SAT1,
 		DP_MSE_SAT_SLOT_COUNT2);
 
+	if (table->stream_count >= 4) {
+		fill_stream_allocation_row_info(
+			&table->stream_allocations[3],
+			&src,
+			&slots);
+	} else {
+		src = 0;
+		slots = 0;
+	}
+
+	set_reg_field_value(
+		value1,
+		src,
+		DP_MSE_SAT1,
+		DP_MSE_SAT_SRC3);
+
+	set_reg_field_value(
+		value1,
+		slots,
+		DP_MSE_SAT1,
+		DP_MSE_SAT_SLOT_COUNT3);
+
 	/* update ASIC MSE stream allocation table */
 	dm_write_reg(ctx, LINK_REG(DP_MSE_SAT0), value0);
 	dm_write_reg(ctx, LINK_REG(DP_MSE_SAT1), value1);
-- 
2.7.4

