From 15696c6b7861f2da7b41f792d09b14da72fae9ad Mon Sep 17 00:00:00 2001
From: Wenjing Liu <Wenjing.Liu@amd.com>
Date: Tue, 3 May 2016 19:01:54 -0400
Subject: [PATCH 0526/1722] drm/amd/dal: Enable Static Screen on FreeSync
 supported Display

Signed-off-by: Wenjing Liu <Wenjing.Liu@amd.com>
Acked-by: Harry Wentland <harry.wentland@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 .../gpu/drm/amd/dal/modules/freesync/freesync.c    | 36 +++++++++++++++++++---
 drivers/gpu/drm/amd/dal/modules/inc/mod_freesync.h |  1 +
 2 files changed, 32 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c b/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c
index ed5a5af..19ba9ac 100644
--- a/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c
+++ b/drivers/gpu/drm/amd/dal/modules/freesync/freesync.c
@@ -201,8 +201,10 @@ bool mod_freesync_set_freesync_on_streams(struct mod_freesync *mod_freesync,
 		/* Disable freesync */
 		v_total_nominal = streams[0]->timing.v_total;
 
-		core_freesync->dc->stream_funcs.dc_stream_adjust_vmin_vmax(core_freesync->dc,
-				streams, num_streams, v_total_nominal, v_total_nominal);
+		core_freesync->dc->stream_funcs.
+			dc_stream_adjust_vmin_vmax(
+				core_freesync->dc, streams, num_streams,
+				v_total_nominal, v_total_nominal);
 
 		return true;
 	} else if (params->mode == FREESYNC_MODE_VARIABLE) {
@@ -211,10 +213,34 @@ bool mod_freesync_set_freesync_on_streams(struct mod_freesync *mod_freesync,
 			if (core_freesync->caps[i].sink == streams[0]->sink &&
 				core_freesync->caps[i].caps.supported) {
 
-				calc_vmin_vmax(streams[0], &core_freesync->caps[i].caps, &v_total_min, &v_total_max);
+				calc_vmin_vmax(streams[0],
+				               &core_freesync->caps[i].caps,
+				               &v_total_min, &v_total_max);
 
-				core_freesync->dc->stream_funcs.dc_stream_adjust_vmin_vmax(core_freesync->dc,
-									streams, num_streams, v_total_min, v_total_max);
+				core_freesync->dc->stream_funcs.
+					dc_stream_adjust_vmin_vmax(
+						core_freesync->dc, streams,
+						num_streams, v_total_min,
+						v_total_max);
+
+				return true;
+			}
+		}
+	} else if (params->mode == FREESYNC_MODE_STATIC_SCREEN) {
+		/* Enable Static Screen */
+		for (i = 0; i < core_freesync->num_sinks; i++) {
+			if (core_freesync->caps[i].sink == streams[0]->sink &&
+				core_freesync->caps[i].caps.supported) {
+
+				calc_vmin_vmax(streams[0],
+				               &core_freesync->caps[i].caps,
+				               &v_total_min, &v_total_max);
+
+				core_freesync->dc->stream_funcs.
+					dc_stream_adjust_vmin_vmax(
+						core_freesync->dc, streams,
+						num_streams, v_total_max,
+						v_total_max);
 
 				return true;
 			}
diff --git a/drivers/gpu/drm/amd/dal/modules/inc/mod_freesync.h b/drivers/gpu/drm/amd/dal/modules/inc/mod_freesync.h
index 8df086a..4ca09d2 100644
--- a/drivers/gpu/drm/amd/dal/modules/inc/mod_freesync.h
+++ b/drivers/gpu/drm/amd/dal/modules/inc/mod_freesync.h
@@ -35,6 +35,7 @@ struct mod_freesync {
 enum mod_freesync_mode {
 	FREESYNC_MODE_DISABLED,
 	FREESYNC_MODE_FIXED,
+	FREESYNC_MODE_STATIC_SCREEN,
 	FREESYNC_MODE_VARIABLE,
 };
 
-- 
2.7.4

