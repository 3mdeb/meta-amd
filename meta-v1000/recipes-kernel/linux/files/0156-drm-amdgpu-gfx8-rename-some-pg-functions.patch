From 191d012fa738a070c186295ccbb6ee53debb595c Mon Sep 17 00:00:00 2001
From: Alex Deucher <alexander.deucher@amd.com>
Date: Tue, 3 May 2016 18:13:45 -0400
Subject: [PATCH 0156/1722] drm/amdgpu/gfx8: rename some pg functions

So they can be shared with other asics.

Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Kalyan Alle <kalyan.alle@amd.com>
---
 drivers/gpu/drm/amd/amdgpu/gfx_v8_0.c | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)

diff --git a/drivers/gpu/drm/amd/amdgpu/gfx_v8_0.c b/drivers/gpu/drm/amd/amdgpu/gfx_v8_0.c
index 2d9e672..47e9494 100644
--- a/drivers/gpu/drm/amd/amdgpu/gfx_v8_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/gfx_v8_0.c
@@ -5294,6 +5294,13 @@ static void gfx_v8_0_enable_gfx_static_mg_power_gating(struct amdgpu_device *ade
 {
 	 uint32_t data, temp;
  
+         if (adev->asic_type == CHIP_POLARIS11)
+                /* Send msg to SMU via Powerplay */
+                amdgpu_set_powergating_state(adev,
+                                             AMD_IP_BLOCK_TYPE_SMC,
+                                             enable ?
+                                             AMD_PG_STATE_GATE : AMD_PG_STATE_UNGATE);
+ 
 	 if (enable) {
 		 /* Enable static MGPG */
 		 temp = data = RREG32(mmRLC_PG_CNTL);
@@ -5405,6 +5412,22 @@ static int gfx_v8_0_set_powergating_state(void *handle,
 		else
 		       gfx_v8_0_enable_gfx_dynamic_mg_power_gating(adev, false);
 		break;
+        case CHIP_POLARIS11:
+                if ((adev->pg_flags & AMD_PG_SUPPORT_GFX_SMG) && enable)
+                        gfx_v8_0_enable_gfx_static_mg_power_gating(adev, true);
+                else
+                        gfx_v8_0_enable_gfx_static_mg_power_gating(adev, false);
+
+                if ((adev->pg_flags & AMD_PG_SUPPORT_GFX_DMG) && enable)
+                        gfx_v8_0_enable_gfx_dynamic_mg_power_gating(adev, true);
+                else
+                        gfx_v8_0_enable_gfx_dynamic_mg_power_gating(adev, false);
+
+                if ((adev->pg_flags & AMD_PG_SUPPORT_GFX_QUICK_MG) && enable)
+                        polaris11_enable_gfx_quick_mg_power_gating(adev, true);
+                else
+                        polaris11_enable_gfx_quick_mg_power_gating(adev, false);
+                break;
 	default:
 		break;
 	}
-- 
2.7.4

